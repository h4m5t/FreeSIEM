{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Welcome to MkDocs","text":"<p>For full documentation visit mkdocs.org.</p>"},{"location":"#commands","title":"Commands","text":"<ul> <li><code>mkdocs new [dir-name]</code> - Create a new project.</li> <li><code>mkdocs serve</code> - Start the live-reloading docs server.</li> <li><code>mkdocs build</code> - Build the documentation site.</li> <li><code>mkdocs -h</code> - Print help message and exit.</li> </ul>"},{"location":"#project-layout","title":"Project layout","text":"<pre><code>mkdocs.yml    # The configuration file.\ndocs/\n    index.md  # The documentation homepage.\n    ...       # Other markdown pages, images and other files.\n</code></pre>"},{"location":"all_doc/","title":"\u6587\u6863\u6c47\u603b","text":"<p>Wazuh</p> <p>https://documentation.wazuh.com/</p> <p>Shuffle</p> <p>https://shuffler.io/docs</p> <p>Thehive4</p> <p>https://docs.thehive-project.org/thehive/</p> <p>Thehive5</p> <p>https://docs.strangebee.com/thehive/setup/</p> <p>Cortex</p> <p>https://docs.thehive-project.org/cortex/</p> <p>MISP</p> <p>\u5728\u7ebf\u7248\uff1ahttps://www.circl.lu/doc/misp/</p> <p>PDF\u7248\uff1ahttps://www.circl.lu/doc/misp/book.pdf</p>"},{"location":"cipankuorong/","title":"\u78c1\u76d8\u6269\u5bb9","text":"<p>Ubuntu LVM\u78c1\u76d8\u6269\u5bb9\uff1a</p> <p>\u6269\u5bb9\u524d\uff1a</p> <pre><code>#df -h\n\nFilesystem                         Size  Used Avail Use% Mounted on\nudev                               3.9G     0  3.9G   0% /dev\ntmpfs                              796M  1.5M  795M   1% /run\n/dev/mapper/ubuntu--vg-ubuntu--lv  9.8G  8.2G  1.1G  89% /\ntmpfs                              3.9G     0  3.9G   0% /dev/shm\ntmpfs                              5.0M     0  5.0M   0% /run/lock\ntmpfs                              3.9G     0  3.9G   0% /sys/fs/cgroup\n/dev/loop0                          62M   62M     0 100% /snap/core20/1328\n/dev/sda2                          1.4G  307M  998M  24% /boot\n/dev/loop2                          44M   44M     0 100% /snap/snapd/14978\n/dev/loop1                          68M   68M     0 100% /snap/lxd/21835\ntmpfs                              796M     0  796M   0% /run/user/1000\n\n\n#lsblk\n\nNAME                      MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT\nloop0                       7:0    0 61.9M  1 loop /snap/core20/1328\nloop1                       7:1    0 67.2M  1 loop /snap/lxd/21835\nloop2                       7:2    0 43.6M  1 loop /snap/snapd/14978\nsda                         8:0    0   16G  0 disk\n\u251c\u2500sda1                      8:1    0    1M  0 part\n\u251c\u2500sda2                      8:2    0  1.4G  0 part /boot\n\u2514\u2500sda3                      8:3    0 14.6G  0 part\n  \u2514\u2500ubuntu--vg-ubuntu--lv 253:0    0   10G  0 lvm  /\nsdb                         8:16   0  484G  0 disk\nsr0                        11:0    1 1024M  0 rom\n\n\n\n#pvdisplay\n  --- Physical volume ---\n  PV Name               /dev/sda3\n  VG Name               ubuntu-vg\n  PV Size               &lt;14.58 GiB / not usable 0\n  Allocatable           yes\n  PE Size               4.00 MiB\n  Total PE              3732\n  Free PE               1172\n  Allocated PE          2560\n  PV UUID               UsKYdO-8NJ3-pFkC-jdyf-4fhP-iAIi-9c075z\n\n  \"/dev/sdb\" is a new physical volume of \"484.00 GiB\"\n  --- NEW Physical volume ---\n  PV Name               /dev/sdb\n  VG Name\n  PV Size               484.00 GiB\n  Allocatable           NO\n  PE Size               0\n  Total PE              0\n  Free PE               0\n  Allocated PE          0\n  PV UUID               2KaSOV-eLvT-qvUY-L3NX-iSvW-zNu2-WfWKlB\n\n</code></pre> <p>\u6269\u5bb9\u65b9\u6cd5</p> <pre><code># \u521b\u5efa\u7269\u7406\u5377\npvcreate /dev/sdb\n  Physical volume \"/dev/sdb\" successfully created\n\n# \u5c06\u78c1\u76d8\u52a0\u5230vg_data \u903b\u8f91\u7ec4\u4e2d\nvgextend ubuntu-vg /dev/sdb\n\n#vgdisplay\n--- Volume group ---\n  VG Name               ubuntu-vg\n  System ID\n  Format                lvm2\n  Metadata Areas        2\n  Metadata Sequence No  3\n  VG Access             read/write\n  VG Status             resizable\n  MAX LV                0\n  Cur LV                1\n  Open LV               1\n  Max PV                0\n  Cur PV                2\n  Act PV                2\n  VG Size               498.57 GiB\n  PE Size               4.00 MiB\n  Total PE              127635\n  Alloc PE / Size       2560 / 10.00 GiB\n  Free  PE / Size       125075 / 488.57 GiB\n  VG UUID               dAbRG7-k3Z6-EzUs-1cou-4Qll-HNQf-HOub32\n\n\n# \u6269\u5bb9\u903b\u8f91\u5377\nlvextend -l +100%FREE /dev/mapper/ubuntu--vg-ubuntu--lv\n\n# \u67e5\u770b\u903b\u8f91\u5377\u5bb9\u91cf\nlvdisplay /dev/mapper/ubuntu--vg-ubuntu--lv\n\n  --- Logical volume ---\n  LV Path                /dev/ubuntu-vg/ubuntu-lv\n  LV Name                ubuntu-lv\n  VG Name                ubuntu-vg\n  LV UUID                HAJoth-dCcG-yHoP-UrVH-uzLT-EE2b-zQogUs\n  LV Write Access        read/write\n  LV Creation host, time ubuntu-server, 2022-07-04 20:17:08 +0800\n  LV Status              available\n  # open                 1\n  LV Size                498.57 GiB\n  Current LE             127635\n  Segments               2\n  Allocation             inherit\n  Read ahead sectors     auto\n  - currently set to     256\n  Block device           253:0\n\n# \u91cd\u65b0\u8ba1\u7b97\u903b\u8f91\u5377\u5927\u5c0f\nresize2fs  /dev/mapper/ubuntu--vg-ubuntu--lv\n</code></pre> <p>\u6269\u5bb9\u540e</p> <pre><code>#df -h\n\nFilesystem                         Size  Used Avail Use% Mounted on\nudev                               3.9G     0  3.9G   0% /dev\ntmpfs                              796M  1.5M  795M   1% /run\n/dev/mapper/ubuntu--vg-ubuntu--lv  491G  8.2G  463G   2% /\ntmpfs                              3.9G     0  3.9G   0% /dev/shm\ntmpfs                              5.0M     0  5.0M   0% /run/lock\ntmpfs                              3.9G     0  3.9G   0% /sys/fs/cgroup\n/dev/loop0                          62M   62M     0 100% /snap/core20/1328\n/dev/sda2                          1.4G  307M  998M  24% /boot\n/dev/loop2                          44M   44M     0 100% /snap/snapd/14978\n/dev/loop1                          68M   68M     0 100% /snap/lxd/21835\ntmpfs                              796M     0  796M   0% /run/user/1000\noverlay                            491G  8.2G  463G   2% /var/lib/docker/overlay2/3e8b6037853535471cd5009da49ad37f089c900c5e74111ccf2d8df0905422c8/merged\noverlay                            491G  8.2G  463G   2% /var/lib/docker/overlay2/89a79b752fe3343b51c7b37380c00f4405edb5bceb3dc5415d83b59c00db3ce7/merged\noverlay                            491G  8.2G  463G   2% /var/lib/docker/overlay2/cd3c0af98461798c97f693d2ef58c41ef1673a379207b5f3858837c183aaf0d7/merged\noverlay                            491G  8.2G  463G   2% /var/lib/docker/overlay2/0c30a836f57be6da2ce0147149e9dc8e649917a5721522fd9032a06faba2e470/merged\n</code></pre>"},{"location":"install/","title":"How to install","text":""},{"location":"install/#this-is-a-test","title":"this is a test.","text":"<p>\u6570\u636e\u6d41\u5411\uff1a 1. \u4ecewazuh\u76f4\u63a5\u5230thehive 2. \u4ecewazuh\u5230shuffle\u518d\u5230thehive. 3. \u4eceELK\u5230thehive 4. \u4eceELK\u5230\u5230shuffle\u518d\u5230thehive. 5. \u4eceELK\u5230Wazuh\u518d\u5230thehive 6. \u4eceELK\u5230Wazuh\u518d\u5230shuffle\u518d\u5230thehive 7. ELK\u5230Shuffle\uff0cWazuh\u5230Shuffle\u540c\u65f6\u5b58\u5728\u3002</p>"},{"location":"install/#helllo","title":"helllo","text":"<p>Thehive\u548cCortex\u90fd\u9700\u8981\u7528admin\u8d26\u53f7\u767b\u5f55\uff0c\u521b\u5efa\u65b0\u7684\u7ec4\u7ec7\uff0c\u5728\u65b0\u7ec4\u7ec7\u4e0b\u521b\u5efa\u65b0\u7684\u8d26\u53f7\uff08Org-Admin\u6743\u9650\uff09\uff0c\u518d\u8fdb\u884c\u540e\u7eed\u64cd\u4f5c\u3002admin\u8d26\u6237\u7528\u6765\u505a\u7ba1\u7406\u3002</p> <p>Cortex\u4e0a\u7684analyzers\u53ef\u4ee5\u6dfb\u52a0MISP\u548cVirusTotal\u7b49\u96c6\u6210\u3002MalwareBazaar. abuseipdb\u7b49\u3002</p> <p>\u5728ElasticSearch\u4e2d\uff0c\u521b\u5efa\u8fde\u63a5\u5668\u3002webhook. \u53c2\u8003\uff1ahttps://github.com/archanchoudhury/SOC-OpenSource/blob/main/integration/integration.md \u5728\u89c4\u5219rules\uff08\u9700\u8981enable\uff09\u89e6\u53d1\u544a\u8b66Alert\u65f6\uff0cwebhook\u4f1a\u63a8\u9001\u5230thehive \u6d4b\u8bd5\u5185\u5bb9\u5982\u4e0b\uff1a</p> <pre><code>{\n\"title\" : \"My Auto case\",\n\"description\" : \"A VPN user has connected from a foreign country\"\n\"tlp\" : 3,\n\"tags\" : [\"automatic\", \"creation\"]\n}\n</code></pre> <p>Connectors\u53ef\u80fd\u9700\u8981License\u7684\u6fc0\u6d3b\u3002 \u89e3\u51b3\u2f45\u6cd5 \u4f7f\u2f64\u7834\u89e3\u7248\uff0c\u6fc0\u6d3bLicense \u6bcf\u6b21\u5230\u671f\u4e4b\u540e\u91cd\u65b0\u90e8\u7f72\uff0c\u8bd5\u2f64\u671f\u4f1a\u5237\u65b0 \u4f7f\u2f64Wazuh ElastAlert</p> <p>Wazuh\u548cthehive\u96c6\u6210 https://github.com/crow1011/wazuh2thehive https://wazuh.com/blog/using-wazuh-and-thehive-for-threat-protection-and-incident-response/ https://github.com/TheHive-Project/TheHive4py</p>"},{"location":"install_MISP/","title":"\u642d\u5efaMISP","text":""},{"location":"install_MISP/#_1","title":"\u4e00\u3001\u4ecb\u7ecd","text":"<p>MISP \u662f\u4e00\u6b3e\u5f00\u6e90\u8f6f\u4ef6\u89e3\u51b3\u65b9\u6848\uff0c\u7528\u4e8e\u6536\u96c6\u3001\u5b58\u50a8\u3001\u5206\u53d1\u548c\u5171\u4eab\u6709\u5173\u7f51\u7edc\u5b89\u5168\u4e8b\u4ef6\u5206\u6790\u548c\u6076\u610f\u8f6f\u4ef6\u5206\u6790\u7684\u7f51\u7edc\u5b89\u5168\u6307\u6807\u548c\u5a01\u80c1\u3002MISP \u662f\u7531\u4e8b\u4ef6\u5206\u6790\u5e08\u3001\u5b89\u5168\u548c ICT \u4e13\u4e1a\u4eba\u5458\u6216\u6076\u610f\u8f6f\u4ef6\u9006\u5411\u8005\u8bbe\u8ba1\u7684\uff0c\u65e8\u5728\u652f\u6301\u4ed6\u4eec\u7684\u65e5\u5e38\u8fd0\u8425\uff0c\u4ece\u800c\u6709\u6548\u5730\u5171\u4eab\u7ed3\u6784\u5316\u4fe1\u606f\u3002</p> <p>MISP \u7684\u76ee\u6807\u662f\u4fc3\u8fdb\u5b89\u5168\u754c\u5185\u5916\u7684\u7ed3\u6784\u5316\u4fe1\u606f\u5171\u4eab\u3002MISP \u63d0\u4f9b\u7684\u529f\u80fd\u4e0d\u4ec5\u652f\u6301\u4fe1\u606f\u4ea4\u6362\uff0c\u8fd8\u652f\u6301\u7f51\u7edc\u5165\u4fb5\u68c0\u6d4b\u7cfb\u7edf (NIDS)\u3001LIDS \u4ee5\u53ca\u65e5\u5fd7\u5206\u6790\u5de5\u5177\u3001SIEM \u5bf9\u6240\u8ff0\u4fe1\u606f\u7684\u4f7f\u7528\u3002</p> <p>\u5b98\u7f51\uff1a</p> <p>https://github.com/MISP/MISP</p> <p>https://www.misp-project.org/download/</p> <p>\u6559\u7a0b\uff1a https://misp.gitbooks.io/misp-book/content/</p> <p>https://www.circl.lu/doc/misp/book.pdf</p>"},{"location":"install_MISP/#_2","title":"\u4e8c\u3001\u5b89\u88c5","text":""},{"location":"install_MISP/#21","title":"2.1\u4f7f\u7528\u5b89\u88c5\u811a\u672c","text":"<p>curl https://raw.githubusercontent.com/MISP/MISP/2.4/INSTALL/INSTALL.sh -o misp_install.sh -k</p> <p>wget -O /tmp/INSTALL.sh https://raw.githubusercontent.com/MISP/MISP/2.4/INSTALL/INSTALL.sh bash /tmp/INSTALL.sh -A</p> <p>\u591a\u6b21\u5c1d\u8bd5\u5b89\u88c5\u5931\u8d25\uff0c\u663e\u793asha1\u6821\u9a8c\u5931\u8d25\uff0c\u672a\u80fd\u89e3\u51b3\u3002</p> <p>\u5728\u5bb6\u4e2d\u81ea\u5df1\u7535\u8111\u4e0a\u5c1d\u8bd5\uff0c\u6709\u65f6\u6821\u9a8c\u6210\u529f\uff0c\u6709\u65f6\u6821\u9a8c\u5931\u8d25\u3002</p> <p>\u4f7f\u7528\u5b89\u88c5\u811a\u672c\u5931\u8d25\uff0c\u8003\u8651\u4f7f\u7528\u955c\u50cf\u90e8\u7f72\u3002</p>"},{"location":"install_MISP/#22","title":"2.2\u4f7f\u7528\u955c\u50cf","text":"<p>\u4ece\u5b98\u7f51\u4e0b\u8f7dOVA\u955c\u50cf\uff0c</p> <p>https://vm.misp-project.org/</p> <p>VMware\u5b89\u88c5\u5373\u53ef\u3002</p> <pre><code>For the MISP web interface -&gt; admin@admin.test:admin\nFor the system -&gt; misp:Password1234\n</code></pre> <pre><code>sudo -u www-data /var/www/MISP/app/Console/cake Baseurl https://a.b.c.d\nsudo systemctl restart apache2\n</code></pre> <p>MISP.password1</p> <p>\u627e\u5230API TOken https://github.com/MISP/MISP/issues/5508</p> <pre><code>eybqhsnylpJ6gHyx0xBYc11MrnvIL3oVETm4NC6v\n</code></pre>"},{"location":"install_MISP/#23docker","title":"2.3docker\u5b89\u88c5","text":"<p>\u642d\u5efa\u4e4b\u540e\u7684\u521d\u59cb\u7528\u6237\u540d\u548c\u5bc6\u7801\u4e3a\uff1a</p> <p>MISP\u521d\u59cb\u5bc6\u7801</p> <p>admin@admin.test</p> <p>admin</p> <pre><code>misp:    image: coolacid/misp-docker:core-latest    restart: unless-stopped    depends_on:       - misp_mysql    ports:      - \"0.0.0.0:80:80\"      - \"0.0.0.0:443:443\"    volumes:      - \"./server-configs/:/var/www/MISP/app/Config/\"      - \"./logs/:/var/www/MISP/app/tmp/logs/\"      - \"./files/:/var/www/MISP/app/files\"      - \"./ssl/:/etc/nginx/certs\"    environment:      - MYSQL_HOST=misp_mysql      - MYSQL_DATABASE=mispdb      - MYSQL_USER=mispuser      - MYSQL_PASSWORD=misppass      - MISP_ADMIN_EMAIL=mispadmin@lab.local      - MISP_ADMIN_PASSPHRASE=mispadminpass      - MISP_BASEURL=localhost      - TIMEZONE=Europe/London      - \"INIT=true\"               - \"CRON_USER_ID=1\"         - \"REDIS_FQDN=redis\"      - \"HOSTNAME=https://192.168.76.148\"    networks:      - SOC_NET   misp_mysql:    image: mysql/mysql-server:5.7    restart: unless-stopped    volumes:      - mispsqldata:/var/lib/mysql       environment:      - MYSQL_DATABASE=mispdb      - MYSQL_USER=mispuser      - MYSQL_PASSWORD=misppass      - MYSQL_ROOT_PASSWORD=mispass    networks:      - SOC_NET  redis:    image: redis:5.0.6    networks:      - SOC_NET  misp-modules:    image: coolacid/misp-docker:modules-latest    environment:      - \"REDIS_BACKEND=redis\"    depends_on:      - redis      - misp_mysql    networks:      - SOC_NET    volumes:  miniodata:  cassandradata:  elasticsearchdata:  cortexdata:  thehivedata:  mispsqldata: networks:    SOC_NET:          driver: bridge\n</code></pre>"},{"location":"install_SO2.3/","title":"SecurityOnion\u5b89\u88c5","text":""},{"location":"install_SO2.3/#securityonion_1","title":"\u4e00\u3001SecurityOnion\u4ecb\u7ecd","text":"<p>https://securityonionsolutions.com/</p> <p>https://blog.securityonion.net/</p> <p>https://github.com/Security-Onion-Solutions/securityonion</p> <p>Linux distro for threat hunting, enterprise security monitoring, and log management</p> <p>Security Onion includes a native web interface with built-in tools analysts use to respond to alerts, hunt for evil, catalog evidence into cases, monitor grid performance, and much more. Additionally, third-party tools, such as Elasticsearch, Logstash, Kibana, Suricata, Zeek (formerly known as Bro), Wazuh, Stenographer, CyberChef, NetworkMiner, and many more are included.</p> <p>Security Onion is a free and open platform for threat hunting, enterprise security monitoring, and log management. It includes our own interfaces for alerting, dashboards, hunting, PCAP, and case management. It also includes other tools such as Playbook, osquery, CyberChef, Elasticsearch, Logstash, Kibana, Suricata, and Zeek.</p> <p>\u76ee\u524d\u5df2\u66f4\u65b0\u81f32.4\u7248\u672c\uff0c\u4f7f\u7528Elastic Fleet\u67b6\u6784\u3002</p>"},{"location":"install_SO2.3/#_1","title":"\u4e8c\u3001\u642d\u5efa","text":""},{"location":"install_SO2.3/#21","title":"2.1\u4e0b\u8f7d\u955c\u50cf","text":"<p>https://github.com/Security-Onion-Solutions/securityonion/blob/master/VERIFY_ISO.md</p>"},{"location":"install_SO2.3/#22","title":"2.2\u5b89\u88c5\u955c\u50cf","text":"<p>\u6ce8\u610f\uff0c\u9009\u62e9\u5408\u9002\u7684\u5185\u5b58\u5927\u5c0f\uff0c\u7cfb\u7edf\u7248\u672c\u3002</p> <ol> <li>From the VMware main window, select File &gt;&gt; New Virtual Machine.</li> <li>Select Typical installation &gt;&gt; Click <code>Next</code>.</li> <li>Installer disc image file &gt;&gt; SO ISO file path &gt;&gt; Click <code>Next</code>.</li> <li>Choose Linux, CentOS 7 64-Bit and click <code>Next</code>.</li> <li>Specify virtual machine name and click <code>Next</code>.</li> <li>Specify disk size (minimum 200GB), store as single file, click <code>Next</code>.</li> <li>Customize hardware and increase Memory and Processors based on the Hardware Requirements section.</li> <li>Network Adapter (NAT or Bridged \u2013 if you want to be able to access your Security Onion machine from other devices in the network, then choose Bridged, otherwise choose NAT to leave it behind the host) \u2013 in this tutorial, this will be the management interface.</li> <li>Add &gt;&gt; Network Adapter (Bridged) - this will be the sniffing (monitor) interface.</li> <li>Click <code>Close</code>.</li> <li>Click <code>Finish</code>.</li> <li>Power on the virtual machine and then follow the installation steps for your desired installation type in the Installation section.</li> </ol>"},{"location":"install_SO2.3/#23","title":"2.3\u5f00\u59cb\u914d\u7f6e","text":"<p>\u6ce8\u610f\uff1aTAB\u952e\u662f\u9009\u62e9\uff0c\u7a7a\u683c\u952e\u662f\u5355\u51fb\uff0c\u56de\u8f66\u952e\u662f\u786e\u8ba4\u3002</p> <p>\u5b89\u88c5\u65f6\u4e00\u822c\u9009\u62e9STANDALONE\u6a21\u5f0f\u3002</p> <p>\u521d\u59cb\u5316\u8fc7\u7a0b\u4e2d\u9700\u8981\u8f93\u5165\u7684\u914d\u7f6e\u8f83\u591a\uff0c\u6839\u636e\u63d0\u793a\u9009\u62e9\u5408\u9002\u7684\u5373\u53ef\u3002</p> <p>\u9009\u62e9\u7f51\u5361\u548c\u9759\u6001IP\u3002</p> <p>\u914d\u7f6eLinux\u7cfb\u7edf\u7684\u7528\u6237\u540d\u548c\u5bc6\u7801\u3002</p> <p>\u914d\u7f6eweb\u63a5\u53e3\u7684\u90ae\u7bb1\u548c\u5bc6\u7801\u3002</p> <p>\u9009\u62e9yes\u5141\u8bb8so-allow\u8bbf\u95eeweb\u5de5\u5177\u3001\u56e0\u4e3a\u5b89\u88c5\u5b8c\u6210\u540e\u6211\u4eec\u8981\u4f7f\u7528sudo so-allow \u6765\u542f\u52a8web\u754c\u9762</p> <p>\u63d0\u793a\u8f93\u5165\u5141\u8bb8\u8bbf\u95ee\u7684IP\u8303\u56f4\u3002</p> <p>\u8fdb\u884c\u521d\u59cb\u5316\uff1a\u65f6\u95f4\u6f2b\u957f\uff0c\u53ef\u80fd\u9700\u8981\u5341\u51e0\u4e2a\u5c0f\u65f6\u3002</p>"},{"location":"install_SO2.3/#24","title":"2.4\u542f\u52a8","text":"<p>\u5b89\u88c5\u5b8c\u6210\u540e\u91cd\u542f\uff0c\u4f7f\u7528Linux\u7cfb\u7edf\u7684\u7528\u6237\u540d\u548c\u5bc6\u7801\u767b\u5f55\u3002</p> <p>\u8f93\u5165sudo so-allow</p> <p>\u9009\u62e9a)</p> <p>\u53ef\u80fd\u8fd8\u9700\u8981\u518d\u8f93\u5165\u4e00\u904d\u5141\u8bb8\u8bbf\u95ee\u7684\u6e90IP\u8303\u56f4\u3002</p> <p>\u4f7f\u7528\u547d\u4ee4sudo so-status \u67e5\u770b\u8fd0\u884c\u670d\u52a1\u72b6\u6001</p>"},{"location":"install_SO2.3/#_2","title":"\u4e09\u3001\u4f7f\u7528\u8bf4\u660e","text":""},{"location":"install_SO2.3/#31","title":"3.1\u767b\u5f55","text":"<p>\u767b\u5f55\u540e\u4e3b\u754c\u9762\u5982\u4e0b\uff1a</p> <p>Kibana\u754c\u9762\u3002</p> <p>Grafana\u754c\u9762\uff1a</p> <p>playbook\u754c\u9762\uff1a</p> <p>Fleet\u754c\u9762\u3002</p>"},{"location":"install_SO2.3/#_3","title":"\u56db\u3001\u53c2\u8003\u8d44\u6599","text":"<p>\u867d\u7136\u662f\u955c\u50cf\uff0c\u4f46\u5b89\u88c5\u8fc7\u7a0b\u8f83\u4e3a\u7e41\u7410\u3002</p> <p>\u53ef\u80fd\u4f1a\u56e0\u4e3a\u201c\u5185\u5b58\u4e0d\u8db3\u201d\uff0c\u201c\u7f51\u7edc\u4e0d\u901a\u201d\uff0c\u201c\u5b89\u88c5\u6162\u201d\u7b49\u539f\u56e0\u5931\u8d25\u3002\u53ef\u4ee5\u770b\u53c2\u8003\u6587\u6863\u6392\u67e5\u89e3\u51b3\u3002\u5982\u679c\u5b89\u88c5\u901f\u5ea6\u5f88\u6162\uff0c\u8d85\u8fc7\u5341\u51e0\u4e2a\u5c0f\u65f6\uff0c\u8bf7\u8010\u5fc3\u7b49\u5f85\uff0c\u6216\u91cd\u65b0\u5b89\u88c5\u3002</p> <p>https://docs.securityonion.net/en/2.3/</p> <p>Vmware workstation12\u91cc\u5982\u4f55\u6b63\u786e\u5feb\u901f\u5b89\u88c5\u53ef\u89c6\u5316IDS\u7cfb\u7edfSecurity Onion\uff08\u56fe\u6587\u8be6\u89e3\uff09</p> <p>Security-Onion-Solutions/securityonion: Security Onion is a free and open platform for threat hunting, enterprise security monitoring, and log management. It includes our own interfaces for alerting, dashboards, hunting, PCAP, and case management. It also includes other tools such as Playbook, osquery, CyberChef, Elasticsearch, Logstash, Kibana, Suricata, and Zeek.</p> <p>Security-Onion-Solutions\u5b89\u5168\u6d0b\u8471\u5b89\u88c5\u65b9\u6cd5_\u4fe1\u606f\u5b89\u5168\u5174\u8da3\u7231\u597d\u8005\u7684\u535a\u5ba2-CSDN\u535a\u5ba2</p> <p>Install and Setup Security Onion on VirtualBox - [kifarunix.com](http://kifarunix.com)</p> <p>Basic installation of Security Onion 2.3 \u2013 Bjoern Hagedorn</p> <p>Installation Security Onion</p> <p>VMware \u2014 Security Onion 2.3 documentation</p> <p>https://blog.csdn.net/weixin_43543330/article/details/108310251</p> <p>https://zhuanlan.zhihu.com/p/540203990?utm_id=0</p> <p>https://blog.csdn.net/scxiaotan1/article/details/127326059</p> <p>http://www.hackdig.com/01/hack-248769.htm</p>"},{"location":"install_SO2.3/#so24","title":"\u4e94\u3001SO2.4\u642d\u5efa","text":""},{"location":"install_SO2.3/#_4","title":"\u524d\u8a00","text":"<p>2.4\u7248\u672c\u5373\u5c06\u53d1\u5e03\u3002\u4f7f\u7528elastic agent\uff0c\u53d6\u4ee3wazuh,filebeats</p> <p>\u7531\u4e8eElastic Agent\u8986\u76d6\u4e86Security Onion\u4e2d\u4f7f\u7528\u7684\u5927\u90e8\u5206Wazuh\u7528\u4f8b\uff0cWazuh\u4e5f\u5c06\u88ab\u79fb\u9664\u3002 \u8fd9\u79cd\u5355\u4e00\u4ee3\u7406\u67b6\u6784\u5c06\u8282\u7701\u8d44\u6e90\uff0c\u7b80\u5316\u7ba1\u7406\u6d41\u7a0b\uff0c\u5e76\u7b80\u5316Security Onion\u4e2d\u7684\u5347\u7ea7\u8fc7\u7a0b\u3002</p> <p>FleetDM ,osquery agents\u53ef\u80fd\u4e5f\u5c06\u79fb\u9664\u3002</p> <p>\u65b0\u589eInflux DB</p> <p>\u53c2\u8003\uff1a</p> <p>https://blog.securityonion.net/2023/02/security-onion-in-2022-and-2023.html</p> <p>https://blog.securityonion.net/2023/03/security-onion-24-beta-release-now.html</p>"},{"location":"install_SO2.3/#_5","title":"\u5b89\u88c5\u8fc7\u7a0b","text":"<p>\u5b98\u65b9\u955c\u50cf\u8fd8\u672a\u53d1\u5e03\uff0c\u9700\u8981\u5728Rocky Linux 9 Minimal\u4e0a\u624b\u52a8\u5b89\u88c5\u3002</p> <p>\u6ce8\u610f\uff0c\u6309\u5b98\u65b9\u8bf4\u6cd5\uff0c\u4e4b\u540e\u7684\u7cfb\u7edf\u955c\u50cf\u53ef\u80fd\u90fd\u4f1a\u5728Rocky Linux 9\u4e0a\u8fdb\u884c\u6784\u5efa\uff0c\u9700\u8981\u63d0\u524d\u719f\u6089\u6b64\u7cfb\u7edf\u3002</p> <pre><code>Security Onion Virtual Appliance based on Rocky Linux 9\n\nWhen we were laying out features for Security Onion 2.4, we really wanted to shift the focus away from the OS and more into features that help our users find evil. Users should be able to image a system or run a script to easily provision their grid. We felt that we needed to shift to more of a virtual appliance model to allow us to continue to grow and scale to the needs of the future. We are basing this new appliance model on Rocky Linux 9. This change will allow us to deliver features faster and simplify support of the platform. Rocky Linux 9 has an EOL date of March 2032 allowing us to continue to innovate on the platform for years to come. Users will be able to install Security Onion either from our ISO image or on top of a minimal installation of Rocky Linux 9. Below we explain how this will impact Ubuntu-based deployments.\n</code></pre>"},{"location":"install_SO2.3/#rocky-linux-9","title":"\u5b89\u88c5Rocky Linux 9","text":"<p>\u9996\u5148\u4e0b\u8f7dhttps://download.rockylinux.org/pub/rocky/9/isos/x86_64/Rocky-9.1-x86_64-minimal.iso</p> <p>\u5b89\u88c5\u6b64\u7cfb\u7edf\uff0c\u53c2\u8003CentOS\u5b89\u88c5\u3002</p>"},{"location":"install_SO2.3/#securityonion-24","title":"\u5b89\u88c5securityonion-2.4","text":"<p>\u5b89\u88c5\u6559\u7a0b\uff1ahttps://docs.securityonion.net/en/2.4/installation.html#installation-on-rocky-linux-or-ubuntu</p> <p>\u6362\u6e90\uff1a</p> <pre><code>sed -e 's|^mirrorlist=|#mirrorlist=|g' \\\n    -e 's|^#baseurl=http://dl.rockylinux.org/$contentdir|baseurl=https://mirrors.ustc.edu.cn/rocky|g' \\\n    -i.bak \\\n    /etc/yum.repos.d/rocky-extras.repo \\\n    /etc/yum.repos.d/rocky.repo\n\ndnf makecache &amp;&amp; dnf update\n</code></pre> <p>git clone -b 2.4/main https://github.com/Security-Onion-Solutions/securityonion</p> <p>\u6216\u624b\u52a8\u4e0b\u8f7d\u89e3\u538b\uff1a</p> <p>dnf install unzip</p> <p>unzip securityonion-2.4-main.zip</p> <p>\u8fdb\u5165\u76ee\u5f55\uff0c\u542f\u52a8\u5b89\u88c5\u7a0b\u5e8f\u3002</p> <p>cd securityonion</p> <p>sudo bash so-setup-network</p>"},{"location":"install_kalipurple/","title":"\u5b89\u88c5Kali Purple","text":""},{"location":"install_kalipurple/#_1","title":"\u4e00\u3001\u4ecb\u7ecd","text":"<p>\u53c2\u8003\uff1ahttps://www.kali.org/blog/kali-linux-2023-1-release/</p> <p>https://gitlab.com/kalilinux/kali-purple/documentation/-/wikis/home</p> <p>\u4eca\u5e74\u662fKali\u53d1\u5e03\u768410\u5468\u5e74\uff0cKali\u5b98\u65b9\u4e5f\u63a8\u51fa\u4e86\u4e00\u6b3e\u65b0\u7684\u9632\u5fa1\u7cfb\u7edf\uff0cKali Purple\u3002</p> <p>Kali\u4e0d\u4ec5\u662f\u8fdb\u653b\uff0c\u800c\u4e14\u5f00\u59cb\u9632\u5b88\u3002</p> <p>Kali Purple \u4ece\u4e00\u4e2a\u6982\u5ff5\u9a8c\u8bc1\u5f00\u59cb\uff0c\u6f14\u53d8\u6210\u4e00\u4e2a\u6846\u67b6\uff0c\u7136\u540e\u662f\u4e00\u4e2a\u5e73\u53f0\uff08\u5c31\u50cf\u4eca\u5929\u7684 Kali \u4e00\u6837\uff09\u3002\u76ee\u6807\u662f\u8ba9\u6bcf\u4e2a\u4eba\u90fd\u80fd\u83b7\u5f97\u4f01\u4e1a\u7ea7\u5b89\u5168\u6027\u3002</p> <p>What is in Kali Purple?</p> <p>On a higher level, Kali Purple consists of:</p> <ul> <li>A reference architecture for the ultimate SOC In-A-Box; perfect for:</li> <li>Learning</li> <li>Practicing SOC analysis and threat hunting</li> <li>Security control design and testing</li> <li>Blue / Red / Purple teaming exercises</li> <li>anKali spy vs. spy competitions ( bare knuckle Blue vs. Red )</li> <li>Protection of small to medium size environments</li> <li>Over 100 defensive tools, such as:</li> <li>Arkime - Full packet capture and analysis</li> <li>CyberChef - The cyber swiss army knife</li> <li><code>Elastic Security</code> - Security Information and Event Management</li> <li>GVM - Vulnerability scanner</li> <li>TheHive - Incident response platform</li> <li><code>Malcolm</code> - Network traffic analysis tool suite</li> <li>Suricata - Intrusion Detection System</li> <li>Zeek - (another) Intrusion Detection System (both have their use-cases!)</li> <li>\u2026and of course all the usual Kali tools</li> <li>Defensive tools documentations</li> <li>Pre-generated image</li> <li>Kali Autopilot - an attack script builder / framework for automated attacks</li> <li>Kali Purple Hub for the community to share:</li> <li>Practice pcaps</li> <li>Kali Autopilot scripts for blue teaming exercises</li> <li>Community Wiki</li> <li>A defensive menu structure according to NIST CSF (National Institute of Standards and Technology Critical Infrastructure Cybersecurity):</li> <li>Identify</li> <li>Protect</li> <li>Detect</li> <li>Respond</li> <li>Recover</li> <li>Kali Purple Discord channels for community collaboration and fun</li> <li>And theme: installer, menu entries &amp; Xfce!</li> </ul> <p>\u2026And this is just the beginning of our journey.</p> <p></p>"},{"location":"install_kalipurple/#_2","title":"\u4e8c\u3001\u642d\u5efa","text":"<p>\u6253\u5f00\u5b98\u7f51https://www.kali.org/</p> <p>\u70b9\u51fb\u4e0b\u8f7d\u955c\u50cf\u6587\u4ef6\uff1aKaliPurple</p> <p>VMware\u542f\u52a8\uff0c\u5b89\u88c5\u5373\u53ef\u3002</p> <p>\u65b0\u53d1\u5e03\u7684\u7248\u672c\u4e2d\u4e0d\u5305\u542bElastic,OpenCTI\u7b49\u7cfb\u7edf\uff0c\u9700\u8981\u81ea\u5df1\u5b89\u88c5\u3002</p>"},{"location":"install_kalipurple/#_3","title":"\u4e09\u3001\u4f7f\u7528\u8bf4\u660e","text":""},{"location":"install_kalipurple/#31","title":"3.1\u7cfb\u7edf\u754c\u9762","text":"<p>\u5168\u65b0\u7684\u754c\u9762\u548c\u83dc\u5355\u680f</p>"},{"location":"install_kalipurple/#32","title":"3.2\u9632\u5fa1\u4f53\u7cfb","text":"<p>\u6839\u636e\u5b89\u5168\u9632\u5fa1\u4f53\u7cfb\uff0c\u6240\u6709\u5b89\u5168\u5de5\u5177\u5206\u4e3a\u4e94\u7c7b\uff1a</p> <ul> <li>IDENTIFY</li> <li>PROTECT</li> <li>DETECT</li> <li>RESPOND</li> <li>RECOVER</li> </ul> <p>\u6211\u4eec\u53ef\u4ee5\u7ed3\u5408\u9700\u8981\uff0c\u6839\u636e\u6b64\u5206\u7c7b\u6269\u5c55\u9700\u8981\u7684\u7ec4\u4ef6\u3002</p>"},{"location":"install_kalipurple/#33","title":"3.3\u5b89\u88c5\u5176\u4ed6\u7ec4\u4ef6","text":""},{"location":"install_kalipurple/#spiderfoot","title":"\u5b89\u88c5spiderfoot","text":"<pre><code>wget https://github.com/smicallef/spiderfoot/archive/v4.0.tar.gz\nls\ntar zxvf spiderfoot-4.0.tar.gz\ncd spiderfoot-4.0\nls\npip3 install -r requirements.txt\nifconfig\nls\npython3 ./sf.py -l 127.0.0.1:5001\n</code></pre>"},{"location":"install_kalipurple/#sn1per","title":"\u5b89\u88c5Sn1per","text":"<pre><code>git clone https://github.com/1N3/Sn1per\nping baidu.com\ntar zxvf Sn1per-9.1.tar.gz\ncd Sn1per-9.1\nls\nbash install.sh\nsniper\nsniper --help\nsniper -t 172.29.249.240 -m web\n</code></pre>"},{"location":"install_kalipurple/#elastic-stack","title":"\u5b89\u88c5Elastic stack","text":"<p>\u53c2\u8003\uff1ahttps://gitlab.com/kalilinux/kali-purple/documentation/-/blob/main/301_kali-purple/installation.txt</p> <pre><code># Elastic stack installation\n\n# 1. Install dependencies:\n# ------------------------\n\nsudo apt-get install curl\ncurl -fsSL https://artifacts.elastic.co/GPG-KEY-elasticsearch | sudo gpg --dearmor -o /etc/apt/trusted.gpg.d/elastic-archive-keyring.gpg\necho \"deb https://artifacts.elastic.co/packages/8.x/apt stable main\" | sudo tee -a /etc/apt/sources.list.d/elastic-8.x.list\nsudo bash -c \"export HOSTNAME=kali-purple.kali.purple; apt-get install elasticsearch -y\"\n\n# take note of \"elastic\" user password\n\n\n# 2. Convert to single-node setup (or replace fqdn name in initial_master_nodes list with IP address):\n# -----------------------------------------------------------------------------------------------------\nsudo sed -e '/cluster.initial_master_nodes/ s/^#*/#/' -i /etc/elasticsearch/elasticsearch.yml\necho \"discovery.type: single-node\" | sudo tee -a /etc/elasticsearch/elasticsearch.yml\n\n\n# 3. Install Kibana:\n# ------------------\nsudo apt install kibana\nsudo /usr/share/kibana/bin/kibana-encryption-keys generate -q\n# Add keys to /etc/kibana/kibana.yml\necho \"server.host: \\\"kali-purple.kali.purple\\\"\" | sudo tee -a /etc/kibana/kibana.yml\n# Ensure kli-purple.kali.purple is only mapped to 192.168.253.5 in /etc/hosts in order to bind Kibana to that interface\nsudo systemctl enable elasticsearch kibana --now\n\n\n\n# 4. Enroll Kibana:\n# -----------------\nsudo /usr/share/elasticsearch/bin/elasticsearch-create-enrollment-token -s kibana\n\n# open browser and navigate to http://192.168.253.5:5601\n# enter username=elastic and password as displayed after installation\n# paste token from above\n\nsudo /usr/share/kibana/bin/kibana-verification-code\n\n# enter verification code into Kibana when prompted\n\n\n\n# 4.Enable HTTPS for Kibana:\n# --------------------------\n\n/usr/share/elasticsearch/bin/elasticsearch-certutil ca\n/usr/share/elasticsearch/bin/elasticsearch-certutil cert --ca elastic-stack-ca.p12 --dns kali-purple.kali.purple,elastic.kali.purple,kali-purple --out kibana-server.p12\nsudo openssl pkcs12 -in /usr/share/elasticsearch/kibana-server.p12 -out /etc/kibana/kibana-server.crt -clcerts -nokeys\nsudo openssl pkcs12 -in /usr/share/elasticsearch/kibana-server.p12 -out /etc/kibana/kibana-server.key -nocerts -nodes\nsudo chown root:kibana /etc/kibana/kibana-server.key\nsudo chown root:kibana /etc/kibana/kibana-server.crt\nsudo chmod 660 /etc/kibana/kibana-server.key\nsudo chmod 660 /etc/kibana/kibana-server.crt\n\necho \"server.ssl.enabled: true\" | sudo tee -a /etc/kibana/kibana.yml\necho \"server.ssl.certificate: /etc/kibana/kibana-server.crt\" | sudo tee -a /etc/kibana/kibana.yml\necho \"server.ssl.key: /etc/kibana/kibana-server.key\" | sudo tee -a /etc/kibana/kibana.yml\necho \"server.publicBaseUrl: \\\"https://kali-purple.kali.purple:5601\\\"\" | sudo tee -a /etc/kibana/kibana.yml\n</code></pre> <p>\u6ce8\u610f\uff0c\u4fdd\u5b58\u5b89\u88c5\u8fc7\u7a0b\u4e2d\u7684\u5bc6\u94a5\uff0cToken\u7b49\u4fe1\u606f\u3002</p> <p>\u8f93\u5165Token,\u5e76\u6ce8\u518c\u4e00\u4e0b\u3002</p> <pre><code>sudo /usr/share/kibana/bin/kibana-verification-code\n</code></pre> <p>\u6dfb\u52a0Security\u96c6\u6210 </p> <p>\u6ce8\u518cFleet</p> <p>\u5b89\u88c5Fleet</p>"},{"location":"install_kalipurple/#_4","title":"\u56db\u3001\u53c2\u8003\u8d44\u6599","text":"<p>https://www.kali.org/blog/kali-linux-2023-1-release/</p> <p>https://gitlab.com/kalilinux/kali-purple/documentation/-/wikis/home</p> <p>https://www.youtube.com/watch?v=UNxrR4mnOnA</p>"},{"location":"install_shuffle/","title":"\u5b89\u88c5shuffle","text":""},{"location":"install_shuffle/#shuffle_1","title":"shuffle\u4ecb\u7ecd","text":"<p>Shuffle is an automation platform for and by the community, focusing on accessibility for anyone to automate. Security operations is complex, but it doesn't have to be.</p> <p>\u56fd\u5916\u6bd4\u8f83\u706b\u7684SOAR\uff08\u5b89\u5168\u7f16\u6392\u81ea\u52a8\u5316\u4e0e\u54cd\u5e94\uff09\u5de5\u4f5c\u6d41\u81ea\u52a8\u5316\u5de5\u5177\uff0c\u53ef\u4ee5\u8fde\u63a5\u5f88\u591a\u5176\u4ed6\u7cfb\u7edf\u3002</p>"},{"location":"install_shuffle/#shuffle_2","title":"\u5b89\u88c5shuffle","text":""},{"location":"install_shuffle/#1dockerdocker-compose","title":"1.\u4e0b\u8f7ddocker\u548cdocker-compose","text":"<p>\u5b89\u88c5docker,\u4f7f\u7528\u5b98\u65b9\u811a\u672c\u5b89\u88c5\u3002</p> <pre><code>curl -fsSL https://get.docker.com | bash -s docker --mirror Aliyun\n</code></pre> <p>\u5b89\u88c5docker-compose</p> <pre><code>#\u4e0b\u8f7d\u4e8c\u8fdb\u5236\u5305\uff0c\u53ef\u4ee5\u4f7f\u7528\u56fd\u5185\u4ed3\u5e93\u66ff\u6362\uff0c\u5982\u679c\u63d0\u793a\u8bc1\u4e66\u4e0d\u5b89\u5168\uff0c\u5219\u52a0\u4e0a--insecure\u53c2\u6570\u3002\nsudo curl -L \"https://github.com/docker/compose/releases/download/v2.2.2/docker-compose-$(uname -s)-$(uname -m)\" -o /usr/local/bin/docker-compose --insecure\n\n#\u5c06\u53ef\u6267\u884c\u6743\u9650\u5e94\u7528\u4e8e\u4e8c\u8fdb\u5236\u6587\u4ef6\uff1a\nsudo chmod +x /usr/local/bin/docker-compose\n\n#\u521b\u5efa\u8f6f\u94fe\nsudo ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose\n\n#\u6d4b\u8bd5\u662f\u5426\u5b89\u88c5\u6210\u529f\uff1a\ndocker-compose version\n</code></pre> <p>\u6216\u624b\u52a8\u5b89\u88c5docker-compose</p> <pre><code>\u4ecegithub\u4e0b\u8f7dhttps://github.com/docker/compose/releases\ndocker-compose-linux-x86_64\n\u4f7f\u7528sftp\u4e0a\u4f20\u5230\u670d\u52a1\u5668\u7684tmp\u76ee\u5f55\u4e0b\u3002\n\u4fee\u6539\u6587\u4ef6\u540d\nmv docker-compose-linux-x86_64 docker-compose\n\u79fb\u52a8\u5230\u76ee\u5f55\u4e0b/usr/local/bin/\nmv docker-compose /usr/local/bin/\nsudo chmod +x /usr/local/bin/docker-compose\nsudo ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose\ndocker-compose version\n</code></pre> <p>docker\u6362\u6e90 <code>vim /etc/docker/daemon.json</code></p> <pre><code>{\n    \"registry-mirrors\" : [\n    \"https://registry.docker-cn.com\",\n    \"https://kfwkfulq.mirror.aliyuncs.com\",\n    \"https://2lqq34jg.mirror.aliyuncs.com\",\n    \"https://pee6w651.mirror.aliyuncs.com\",\n    \"http://hub-mirror.c.163.com\",\n    \"https://docker.mirrors.ustc.edu.cn\",\n    \"https://cr.console.aliyun.com\",\n    \"https://mirror.ccs.tencentyun.com\"\n  ]\n}\n</code></pre> <p>\u5efa\u8bae\u4f7f\u7528\u963f\u91cc\u4e91docker\u955c\u50cf\u52a0\u901f\u670d\u52a1\uff1ahttps://cr.console.aliyun.com/cn-hangzhou/instances/mirrors</p> <pre><code>{\n  \"registry-mirrors\": [\"https://2aibpl9o.mirror.aliyuncs.com\"]\n}\n</code></pre> <p>\u91cd\u542f\u4f7f\u914d\u7f6e\u751f\u6548</p> <pre><code>systemctl daemon-reload\nsystemctl restart docker.service\n</code></pre> <p>\u67e5\u770b\u6362\u6e90\u662f\u5426\u6210\u529f\uff1a</p> <pre><code>docker info\n</code></pre>"},{"location":"install_shuffle/#2shuffle","title":"2.\u4e0b\u8f7dshuffle","text":"<pre><code>git clone https://github.com/Shuffle/Shuffle\ncd Shuffle\n</code></pre>"},{"location":"install_shuffle/#3","title":"3.\u521b\u5efa\u6570\u636e\u5e93","text":"<pre><code>mkdir shuffle-database\nsudo chown -R 1000:1000 shuffle-database\n</code></pre>"},{"location":"install_shuffle/#4","title":"4.\u542f\u52a8","text":"<pre><code>docker-compose up -d\n</code></pre> <p>\u8fd9\u4e00\u6b65\u53ef\u80fd\u4f1a\u62a5\u9519\uff1a</p> <pre><code>error pulling image configuration: download failed after attempts=6: x509: certificate signed by unknown authority\n</code></pre> <p>\u89e3\u51b3\u65b9\u6cd5\uff1a</p> <pre><code>\u5c06ghcr.io\u66ff\u6362\u4e3aghcr.nju.edu.cn\n\u53c2\u8003\uff1ahttps://zhuanlan.zhihu.com/p/602161992\n</code></pre>"},{"location":"install_shuffle/#5","title":"5.\u4fee\u6539\u53c2\u6570","text":"<p>\u6211\u6ca1\u6539\uff0c\u4e5f\u4e0d\u5f71\u54cd\u6b63\u5e38\u4f7f\u7528\u3002</p> <p>Recommended for Opensearch to work well</p> <pre><code>sudo sysctl -w vm.max_map_count=262144             # https://www.elastic.co/guide/en/elasticsearch/reference/current/vm-max-map-count.html\n</code></pre>"},{"location":"install_shuffle/#_1","title":"\u521d\u59cb\u5316\u914d\u7f6e","text":"<p>\u53c2\u8003\uff1a</p> <pre><code>https://github.com/Shuffle/Shuffle/blob/main/.github/install-guide.md#after-installation\n</code></pre>"},{"location":"install_shuffle/#1web","title":"1.\u6253\u5f00web\u9875\u9762","text":"<p>http://localhost:3001</p> <p>\u5c3d\u91cf\u4f7f\u7528https\u8bbf\u95ee\uff0c\u5426\u5219\u540e\u9762Copy WebHook URL\u4f1a\u62a5\u9519\u3002 https://localhost:3443</p>"},{"location":"install_shuffle/#2","title":"2.\u8bbe\u7f6e\u7528\u6237\u540d\u548c\u5bc6\u7801","text":""},{"location":"install_shuffle/#3_1","title":"3.\u6839\u636e\u63d0\u793a\u521b\u5efa\u540e\u7aef\u6570\u636e\u5e93","text":"<p>\u8fd9\u4e00\u6b65\u53ef\u80fd\u9700\u8981\u51e0\u5206\u949f\uff0c\u6709\u53ef\u80fd\u62a5\u9519\u3002</p> <p>\u5982\u679c\u62a5\u9519\uff0c\u8bf7\u89c2\u5bdf\u540e\u7aef\u65e5\u5fd7\u3002\u9002\u5f53\u8c03\u5927\u670d\u52a1\u5668\u7684\u5185\u5b58\u3002</p>"},{"location":"install_shuffle/#4appworkflows","title":"4.\u5bfc\u5165APP\u548cWorkflows","text":"<p>https://shuffler.io/apps</p> <p>\u5b98\u7f51\u63d0\u4f9b\u4e86\u5f88\u591aAPP\u548cworkflows,\u53ef\u4ee5\u76f4\u63a5\u5bfc\u5165\uff0c\u6216\u8005\u4ece\u5b98\u7f51\u4e0b\u8f7d\u540e\u624b\u52a8\u5bfc\u5165\u3002\u9700\u8981\u5728\u5b98\u7f51\u521b\u5efa\u548c\u767b\u5f55\u8d26\u53f7\u3002 \u6709\u4e9b\u5185\u7f6e\u7684APP\uff0c\u6bd4\u5982Shuffle Tools,\u53ea\u80fd\u7528github pull\uff0c\u65e0\u6cd5\u5728\u5b98\u7f51\u4e0b\u8f7d\u540e\u5bfc\u5165\u3002 \u5bf9\u4e8e\u4e00\u4e9b\u7b2c\u4e09\u65b9APP\uff0c\u6bd4\u5982Wazuh,\u53ea\u80fd\u4ece\u5b98\u7f51\u4e0b\u8f7dOpenAPI\uff08yaml\u6587\u4ef6\uff09,\u540e\u518d\u5bfc\u5165\u3002</p> <p>\u63a8\u8350\u5b89\u88c5\u7684\u51e0\u4e2aAPP\uff1a * FortiGate Firewall * Wazuh * Jira * Shuffle * github * Crowdsec * virustotal_v3 * thehive_5</p>"},{"location":"install_shuffle/#_2","title":"\u9047\u5230\u7684\u95ee\u9898","text":"<p>https://github.com/Shuffle/Shuffle/issues/1097</p> <p>\u5b89\u88c5\u4e4b\u540eweb\u754c\u9762\u6b63\u5e38\uff0c\u4f46\u662f\u5de5\u4f5c\u6d41\u4e00\u76f4\u663e\u793a\u6267\u884c\u4e2d\u3002</p> <p>\u67e5\u770bdocker\u65e5\u5fd7\uff1a</p> <pre><code>2023/07/05 08:42:43 [ERROR] Container create error: Error response from daemon: No such image: ghcr.io/shuffle/shuffle-worker:latest\n2023/07/05 08:42:43 [WARNING] Execution ID ca66efea-a673-442d-b40d-e17a9210fe24 failed to deploy: Error response from daemon: No such image: ghcr.io/shuffle/shuffle-worker:latest\n2023/07/05 08:42:43 [ERROR] Container create error: Error response from daemon: No such image: ghcr.io/shuffle/shuffle-worker:latest\n2023/07/05 08:42:43 [WARNING] Execution ID 56f9a8ea-3838-4f92-a26d-c47289e9b5c2 failed to deploy: Error response from daemon: No such image: ghcr.io/shuffle/shuffle-worker:latest\n2023/07/05 08:42:43 [ERROR] Container create error: Error response from daemon: No such image: ghcr.io/shuffle/shuffle-worker:latest\n2023/07/05 08:42:43 [WARNING] Execution ID e0e152c1-6cbd-4f1d-a38b-bc5cac7e0a37 failed to deploy: Error response from daemon: No such image: ghcr.io/shuffle/shuffle-worker:latest\n</code></pre> <pre><code>2023/07/05 08:31:06 [error] 14#14: *11 connect() failed (111: Connection refused) while connecting to upstream, client: 172.29.132.144, server: localhost, request: \"POST /api/v1/hooks/webhook_d7e6ae11-319e-48f8-92ba-9732547a5d19 HTTP/1.1\", upstream: \"http://172.19.0.4:5001/api/v1/hooks/webhook_d7e6ae11-319e-48f8-92ba-9732547a5d19\", host: \"172.29.132.142:3443\"\n172.29.132.144 - - [05/Jul/2023:08:31:06 +0000] \"POST /api/v1/hooks/webhook_d7e6ae11-319e-48f8-92ba-9732547a5d19 HTTP/1.1\" 502 157 \"-\" \"python-requests/2.25.1\"\n2023/07/05 08:31:06 [error] 14#14: *13 connect() failed (111: Connection refused) while connecting to upstream, client: 172.29.132.144, server: localhost, request: \"POST /api/v1/hooks/webhook_d7e6ae11-319e-48f8-92ba-9732547a5d19 HTTP/1.1\", upstream: \"http://172.19.0.4:5001/api/v1/hooks/webhook_d7e6ae11-319e-48f8-92ba-9732547a5d19\", host: \"172.29.132.142:3443\"\n172.29.132.144 - - [05/Jul/2023:08:31:06 +0000] \"POST /api/v1/hooks/webhook_d7e6ae11-319e-48f8-92ba-9732547a5d19 HTTP/1.1\" 502 157 \"-\" \"python-requests/2.25.1\"\n2023/07/05 08:31:07 [error] 14#14: *15 connect() failed (111: Connection refused) while connecting to upstream, client: 172.29.132.144, server: localhost, request: \"POST /api/v1/hooks/webhook_d7e6ae11-319e-48f8-92ba-9732547a5d19 HTTP/1.1\", upstream: \"http://172.19.0.4:5001/api/v1/hooks/webhook_d7e6ae11-319e-48f8-92ba-9732547a5d19\", host: \"172.29.132.142:3443\"\n172.29.132.144 - - [05/Jul/2023:08:31:07 +0000] \"POST /api/v1/hooks/webhook_d7e6ae11-319e-48f8-92ba-9732547a5d19 HTTP/1.1\" 502 157 \"-\" \"python-requests/2.25.1\"\n</code></pre> <p>\u53d1\u73b0\u7f3a\u5c11\u955c\u50cf\u3002</p> <p>\u4e0b\u8f7d\u955c\u50cf\uff1a</p> <pre><code>docker pull frikky/shuffle:shuffle-tools_1.2.0\n\ndocker pull ghcr.io/shuffle/shuffle-worker:latest\n\u6216\u8005\ndocker pull frikky/shuffle:shuffle-worker\n</code></pre> <p>\u5982\u679c\u7528\u4ee3\u7406\u670d\u52a1\u5668\u4e0b\u8f7d\uff0c\u53ef\u80fd\u9700\u8981\u4fee\u6539\u955c\u50cf\u540d(tag\u547d\u4ee4)\uff0c\u4f7f\u5f97\u4e0e\u8981\u6c42\u7684\u4e00\u76f4\u3002</p> <pre><code>docker tag example.example.com:8088/frikky/shuffle:shuffle-tools_1.2.0 frikky/shuffle:shuffle-tools_1.2.0\n</code></pre> <p>\u5982\u679c\u8fd0\u884c\u62a5\u9519\u6216\u4e00\u76f4\u663e\u793a\u6267\u884c\u4e2d\uff0c\u5c31\u67e5\u770b\u540e\u7aef\u65e5\u5fd7\uff1a</p> <p>\u4e3b\u8981\u662fshuffle-orborus\u65e5\u5fd7\u548cshuffle-backend\u65e5\u5fd7\u3002</p> <p>\u67e5\u770b\u65f6\u4f1a\u63d0\u793a\u67e5\u770bWorker Container\u65e5\u5fd7\u3002\u67e5\u770b\u6b64\u65e5\u5fd7\uff0c\u6392\u67e5\u62a5\u9519\u539f\u56e0\u3002</p> <p>\u4e00\u822c\u662f\u955c\u50cf\u95ee\u9898\u6216\u5185\u90e8\u901a\u4fe1\u95ee\u9898\u3002</p>"},{"location":"install_thehive4/","title":"\u5b89\u88c5thehive4","text":""},{"location":"install_thehive4/#step-by-step","title":"step by step\u5b89\u88c5","text":"<p>\u53c2\u8003\u5b98\u65b9\u5b89\u88c5\u6587\u6863\uff1a</p> <p>https://docs.thehive-project.org/thehive/installation-and-configuration/installation/step-by-step-guide/</p> <p>\u53c2\u8003\u5b89\u88c5\u89c6\u9891\uff1a</p> <p>\u5728Ubuntu\u4e0a\u642d\u5efa\u3002\u6211\u7684\u672c\u673aIP\u662f192.168.76.145</p> <p>\u6ce8\u610f\uff0cJava\u548cCassandra\u7248\u672c\u5fc5\u987b\u8981\u6309\u7167\u5b98\u65b9\u7248\u672c\u53bb\u5b89\u88c5\u3002</p>"},{"location":"install_thehive4/#_1","title":"\u7cfb\u7edf\u521d\u59cb\u914d\u7f6e","text":"<pre><code>sudo sed -i 's@//.*archive.ubuntu.com@//mirrors.ustc.edu.cn@g' /etc/apt/sources.list\nsudo apt-get update\nsudo apt-get install git\nsudo apt-get install vim\nsudo apt-get install curl\nsudo apt-get install net-tools\nsudo apt-get install tree\nsudo apt-get install open-vm-tools-desktop #\u865a\u62df\u673a\u5b89\u88c5\uff0c\u65b9\u4fbf\u4ece\u5bbf\u4e3b\u673a\u590d\u5236\u547d\u4ee4\uff0c\u5b89\u88c5\u540e\u91cd\u542f\u751f\u6548\n</code></pre>"},{"location":"install_thehive4/#jvm","title":"\u5b89\u88c5JVM","text":"<p>Java Virtual Machine</p> <pre><code>apt-get install -y openjdk-8-jre-headless\necho JAVA_HOME=\"/usr/lib/jvm/java-8-openjdk-amd64\" &gt;&gt; /etc/environment\nexport JAVA_HOME=\"/usr/lib/jvm/java-8-openjdk-amd64\"\n\n</code></pre>"},{"location":"install_thehive4/#cassandra","title":"\u5b89\u88c5Cassandra","text":"<p>Cassandra database</p> <pre><code>curl -fsSL https://www.apache.org/dist/cassandra/KEYS | sudo apt-key add -\necho \"deb http://www.apache.org/dist/cassandra/debian 311x main\" | sudo tee -a /etc/apt/sources.list.d/cassandra.sources.list\n\n</code></pre> <p>Install from repository,\u53d1\u73b0\u62a5\u9519\uff0c\u5b98\u65b9\u4ed3\u5e93\u5931\u6548\u4e86\u3002</p> <pre><code>sudo apt update\nsudo apt install cassandra\n</code></pre> <p>\u6dfb\u52a0\u6e90\u518d\u5b89\u88c5\uff1a</p> <pre><code>echo \"deb https://debian.cassandra.apache.org 311x main\" | sudo tee -a /etc/apt/sources.list.d/cassandra.sources.list\n\ncurl https://downloads.apache.org/cassandra/KEYS | sudo apt-key add -\n\nsudo apt-get update\n\nsudo apt-get install cassandra\n</code></pre> <p>\u914d\u7f6eCassandra\uff1a</p> <pre><code>cqlsh localhost 9042\ncqlsh&gt; UPDATE system.local SET cluster_name = 'thp' where key='local';\nnodetool flush\n</code></pre> <p>\u4fee\u6539Cassandra\u914d\u7f6e\u6587\u4ef6,cluster_name\u6539\u4e3a'thp'\uff0c\u5c06'xx.xx.xx.xx'\u66ff\u6362\u4e3a\u672c\u673aIP\u3002</p> <pre><code>vi /etc/cassandra/cassandra.yaml\n\n# content from /etc/cassandra/cassandra.yaml\n\ncluster_name: 'thp'\nlisten_address: 'xx.xx.xx.xx' # address for nodes\nrpc_address: 'xx.xx.xx.xx' # address for clients\nseed_provider:\n    - class_name: org.apache.cassandra.locator.SimpleSeedProvider\n      parameters:\n          # Ex: \"&lt;ip1&gt;,&lt;ip2&gt;,&lt;ip3&gt;\"\n          - seeds: 'xx.xx.xx.xx' # self for the first node\ndata_file_directories:\n  - '/var/lib/cassandra/data'\ncommitlog_directory: '/var/lib/cassandra/commitlog'\nsaved_caches_directory: '/var/lib/cassandra/saved_caches'\nhints_directory: \n  - '/var/lib/cassandra/hints'\n</code></pre> <p>\u91cd\u542f</p> <pre><code>systemctl daemon-reload\nservice cassandra restart\n</code></pre> <p>\u68c0\u67e5\u8fd0\u884c\u72b6\u6001\uff1a</p> <pre><code>systemctl status cassandra\n</code></pre> <p>\u67e5\u770b\u5f00\u653e\u7684\u7aef\u53e3</p> <pre><code>netstat -ltpnd\n\n#\u6709\u8fd9\u4e24\u884c\u8bf4\u660e\u8fd0\u884c\u6b63\u5e38\u3002\ntcp        0      0 192.168.76.145:7000     0.0.0.0:*               LISTEN      15268/java          \ntcp        0      0 192.168.76.145:9042     0.0.0.0:*               LISTEN      15268/java        \n</code></pre>"},{"location":"install_thehive4/#the-hive","title":"\u5b89\u88c5the hive","text":"<pre><code>#\u521b\u5efa\u5b58\u50a8\u6587\u4ef6\u5939\nmkdir -p /opt/thp/thehive/files\n\n#\u6dfb\u52a0apt-key\n#\u56fd\u5916\u7528\u6237\u4f7f\u7528\ncurl https://raw.githubusercontent.com/TheHive-Project/TheHive/master/PGP-PUBLIC-KEY | sudo apt-key add -\n\n#\u56fd\u5185\u7528\u6237\u4f7f\u7528\uff0c\u5bf9raw\u7684\u4ee3\u7406\ncurl https://raw.fastgit.org/TheHive-Project/TheHive/master/PGP-PUBLIC-KEY | sudo apt-key add -\n\n\n#\u5b89\u88c5thehive\necho 'deb https://deb.thehive-project.org release main' | sudo tee -a /etc/apt/sources.list.d/thehive-project.list\nsudo apt-get update\nsudo apt-get install thehive4\n\n#\u521b\u5efaIndexing engine\nchown -R thehive:thehive /opt/thp/thehive/files\n\nmkdir /opt/thp/thehive/index\nchown thehive:thehive -R /opt/thp/thehive/index\n</code></pre>"},{"location":"install_thehive4/#_2","title":"\u914d\u7f6e","text":"<p>\u4e3a\u6210\u529f\u8fd0\u884c\u9700\u8981\u505a\u597d\u4ee5\u4e0b\u4e09\u4e2a\u914d\u7f6e\uff1a</p> <ul> <li>Secret key configuration</li> </ul> <pre><code>\u67e5\u770b\u6587\u4ef6\u5185\u662f\u5426\u5b58\u5728\u5bc6\u94a5\u3002\n/etc/thehive/secret.conf\n</code></pre> <ul> <li>Database configuration</li> </ul> <p>\u4fee\u6539\u914d\u7f6e\u6587\u4ef6</p> <pre><code>vi /etc/thehive/application.conf\n</code></pre> <pre><code>db {\n  provider: janusgraph\n  janusgraph {\n    storage {\n      backend: cql  #\u53d6\u6d88\u672c\u884c\u524d\u9762\u6ce8\u91ca\n      hostname: [\"192.168.76.145\"] # \u6539\u4e3a\u672c\u673aIP\n      #username: \"&lt;cassandra_username&gt;\"       # login to connect to database (if configured in Cassandra)\n      #password: \"&lt;cassandra_passowrd\"\n      cql {\n        cluster-name: thp       # cluster name\n        keyspace: thehive           # name of the keyspace\n        local-datacenter: datacenter1   # name of the datacenter where TheHive runs (relevant only on multi datacenter setup)\n        # replication-factor: 2 # number of replica\n        read-consistency-level: ONE\n        write-consistency-level: ONE\n      }\n    }\n  }\n      ## Index configuration\n    index.search {\n      backend : lucene\n      directory:  /opt/thp/thehive/index\n    }\n}\n</code></pre> <ul> <li>File storage configuration</li> </ul> <pre><code>## Storage configuration\nstorage {\nprovider = localfs\nlocalfs.location = /opt/thp/thehive/files\n}\n</code></pre> <p>\u4e0b\u9762\u7ed9\u51fa\u6211\u7684\u5b8c\u6574\u914d\u7f6e\u6587\u4ef6\uff1a</p> <pre><code>###\n## Documentation is available at https://docs.thehive-project.org/thehive/\n###\n\n## Include Play secret key\n# More information on secret key at https://www.playframework.com/documentation/2.8.x/ApplicationSecret\ninclude \"/etc/thehive/secret.conf\"\n\n## Database configuration\ndb.janusgraph {\n  storage {\n    ## Cassandra configuration\n    # More information at https://docs.janusgraph.org/basics/configuration-reference/#storagecql\n    backend: cql\n    hostname: [\"192.168.76.145\"]\n    # Cassandra authentication (if configured)\n    // username: \"thehive\"\n    // password: \"password\"\n    cql {\n      cluster-name: thp\n      keyspace: thehive\n    }\n  }\n  index.search {\n    backend: lucene\n    directory: /opt/thp/thehive/index\n    # If TheHive is in cluster ElasticSearch must be used:\n    // backend: elasticsearch\n    // hostname: [\"ip1\", \"ip2\"]\n    // index-name: thehive\n  }\n\n  ## For test only !\n  # Comment the two lines below before enable Cassandra database\n  storage.backend: berkeleyje\n  storage.directory: /opt/thp/thehive/database\n  // berkeleyje.freeDisk: 200 # disk usage threshold\n}\n\n## Attachment storage configuration\nstorage {\n  ## Local filesystem\n  provider: localfs\n  localfs.location: /opt/thp/thehive/files\n\n  ## Hadoop filesystem (HDFS)\n  // provider: hdfs\n  // hdfs {\n  //   root: \"hdfs://localhost:10000\" # namenode server hostname\n  //   location: \"/thehive\"           # location inside HDFS\n  //   username: thehive              # file owner\n  // }\n}\n\n## Authentication configuration\n# More information at https://github.com/TheHive-Project/TheHiveDocs/TheHive4/Administration/Authentication.md\n//auth {\n//  providers: [\n//    {name: session}               # required !\n//    {name: basic, realm: thehive}\n//    {name: local}\n//    {name: key}\n//  ]\n# The format of logins must be valid email address format. If the provided login doesn't contain `@` the following\n# domain is automatically appended\n//  defaultUserDomain: \"thehive.local\"\n//}\n\n## CORTEX configuration\n# More information at https://github.com/TheHive-Project/TheHiveDocs/TheHive4/Administration/Connectors.md\n# Enable Cortex connector\n// play.modules.enabled += org.thp.thehive.connector.cortex.CortexModule\n// cortex {\n//  servers: [\n//    {\n//      name: \"local\"                # Cortex name\n//      url: \"http://localhost:9001\" # URL of Cortex instance\n//      auth {\n//        type: \"bearer\"\n//        key: \"***\"                 # Cortex API key\n//      }\n//      wsConfig {}                  # HTTP client configuration (SSL and proxy)\n//    }\n//  ]\n// }\n\n## MISP configuration\n# More information at https://github.com/TheHive-Project/TheHiveDocs/TheHive4/Administration/Connectors.md\n# Enable MISP connector\n// play.modules.enabled += org.thp.thehive.connector.misp.MispModule\n// misp {\n//  interval: 1 hour\n//  servers: [\n//    {\n//      name = \"local\"            # MISP name\n//      url = \"http://localhost/\" # URL or MISP\n//      auth {\n//        type = key\n//        key = \"***\"             # MISP API key\n//      }\n//      wsConfig {}               # HTTP client configuration (SSL and proxy)\n//    }\n//  ]\n//}\n\n# Define maximum size of attachments (default 10MB)\n//play.http.parser.maxDiskBuffer: 1GB\n</code></pre>"},{"location":"install_thehive4/#the-hive_1","title":"\u542f\u52a8the hive","text":"<pre><code>service thehive start\n</code></pre> <p>\u67e5\u770b\u8fd0\u884c\u72b6\u6001\uff1a</p> <pre><code>service thehive status\n</code></pre> <p>\u67e5\u770b\u65e5\u5fd7\uff1a</p> <pre><code>tail -f  /var/log/thehive/application.log\n</code></pre>"},{"location":"install_thehive4/#_3","title":"\u9047\u5230\u7684\u95ee\u9898","text":"<p>\u6211\u5728\u6267\u884c<code>cqlsh localhost 9042</code>\u6b64\u547d\u4ee4\u7684\u65f6\u5019\u62a5\u9519\uff0c\u6392\u67e5\u4e86\u5f88\u4e45\u3002</p> <p>Connection error: ('Unable to connect to any servers', {'127.0.0.1': error(10061, \"Tried connecting to [('127.0.0.1', 9042)]. Last error: No connection could be made because the target machine actively refused it\")})</p> <p>\u53ef\u80fd\u662f\u56e0\u4e3a\u521a\u5f00\u59cb\u88c5\u4e864.0\u7248\u672c\uff0c\u5bfc\u81f4\u51fa\u4e86\u95ee\u9898\u3002</p> <p>\u5378\u8f7d\u91cd\u88c5\u3002</p>"},{"location":"install_thehive4/#dockerthe-hive4","title":"docker\u5b89\u88c5the hive4","text":""},{"location":"install_thehive4/#_4","title":"\u6587\u4ef6\u76ee\u5f55","text":"<p>\u6587\u4ef6\u8def\u5f84\u5982\u4e0b\uff1a\u547d\u4ee4\u67e5\u770b\uff1a<code>tree -L 3</code></p> <pre><code>.\n\u251c\u2500\u2500 docker-compose.yml\n\u2514\u2500\u2500 vol\n    \u251c\u2500\u2500 cortex\n    \u2502   \u2514\u2500\u2500 application.conf\n    \u2514\u2500\u2500 thehive\n        \u251c\u2500\u2500 application.conf\n</code></pre>"},{"location":"install_thehive4/#env","title":".env","text":"<p>\u548cdocker-compose\u5728\u540c\u7ea7\u76ee\u5f55\u4e0b\uff1a</p> <pre><code>CORTEX_KEY=[]\nCOMPOSE_PROJECT_NAME=FreeSIEM\nJOB_DIRECTORY=/opt/cortex/jobs\n</code></pre>"},{"location":"install_thehive4/#docker-compose","title":"docker-compose","text":"<p>docker-compose.yml</p> <pre><code>version: '3.8'\nservices:\n  ## Cortex\n  elasticsearch:\n    image: 'elasticsearch:7.11.1'\n    container_name: elasticsearch\n    restart: unless-stopped\n    ports:\n      - '0.0.0.0:9200:9200'\n    environment:\n      - http.host=0.0.0.0\n      - discovery.type=single-node\n      - cluster.name=hive\n      - script.allowed_types= inline\n      - thread_pool.search.queue_size=100000\n      - thread_pool.write.queue_size=10000\n      - gateway.recover_after_nodes=1\n      - xpack.security.enabled=false\n      - bootstrap.memory_lock=true\n      - ES_JAVA_OPTS=-Xms256m -Xmx256m\n    ulimits:\n      nofile:\n        soft: 65536\n        hard: 65536\n    volumes:\n      - './vol/elasticsearch/data:/usr/share/elasticsearch/data'\n      - './vol/elasticsearch/logs:/usr/share/elasticsearch/logs'\n  cortex:\n    image: 'thehiveproject/cortex:latest'\n    container_name: cortex\n    restart: unless-stopped\n    command:\n      --job-directory ${JOB_DIRECTORY}\n    environment:\n      - 'JOB_DIRECTORY=${JOB_DIRECTORY}'\n    volumes:\n      - './vol/cortex/application.conf:/etc/cortex/application.conf'\n      - '${JOB_DIRECTORY}:${JOB_DIRECTORY}'\n      - '/var/run/docker.sock:/var/run/docker.sock'\n    depends_on:\n      - elasticsearch\n    ports:\n      - '0.0.0.0:9001:9001'\n\n  ## TheHive\n  thehive:\n    image: 'thehiveproject/thehive4:latest'\n    container_name: 'thehive4'\n    depends_on:\n      - cassandra\n    ports:\n      - '0.0.0.0:9000:9000'\n    volumes:\n      - ./vol/thehive/application.conf:/etc/thehive/application.conf\n      - ./vol/thehive/data:/opt/thp/thehive/data\n      - ./vol/thehive/index:/opt/thp/thehive/index\n    networks:\n      - default\n    command: '--no-config --no-config-secret'\n\n  cassandra:\n    image: 'cassandra:3.11'\n    container_name: cassandra\n    hostname: cassandra\n    environment:\n      - MAX_HEAP_SIZE=1G\n      - HEAP_NEWSIZE=1G\n      - CASSANDRA_CLUSTER_NAME=thp\n    volumes:\n      - './vol/cassandra/data:/var/lib/cassandra/data'\n\nnetworks:\n  default: null\n</code></pre>"},{"location":"install_thehive4/#cortexapplicationconf","title":"Cortex\u914d\u7f6e\u6587\u4ef6application.conf","text":"<pre><code>## SECRET KEY\n#\n# The secret key is used to secure cryptographic functions.\n#\n# IMPORTANT: If you deploy your application to several  instances,  make\n# sure to use the same key.\nplay.http.secret.key=\"CortexTestPassword\"\n\n## ElasticSearch\nsearch {\n  index = cortex\n  uri = \"http://elasticsearch:9200\"\n}\n\n## Cache\ncache.job = 10 minutes\n\njob {\n  runner = [docker, process]\n}\n\n## ANALYZERS\nanalyzer {\n  urls = [\n    \"https://download.thehive-project.org/analyzers.json\"\n    #\"/absolute/path/of/analyzers\"\n  ]\n}\n\n# RESPONDERS\nresponder {\n  urls = [\n    \"https://download.thehive-project.org/responders.json\"\n    #\"/absolute/path/of/responders\"\n  ]\n}\n</code></pre>"},{"location":"install_thehive4/#thehiveapplicationconf","title":"Thehive\u914d\u7f6e\u6587\u4ef6application.conf","text":"<pre><code># Secret Key\n# The secret key is used to secure cryptographic functions.\n# WARNING: If you deploy your application on several servers, make sure to use the same key.\nplay.http.secret.key=\"dgngu325mbnbc39cxas4l5kb24503836y2vsvsg465989fbsvop9d09ds6df6\"\n\n# JanusGraph\ndb {\n  provider: janusgraph\n  janusgraph {\n    storage {\n      backend: cql\n      hostname: [\"cassandra\"]\n\n      cql {\n        cluster-name: thp       # cluster name\n        keyspace: thehive           # name of the keyspace\n        read-consistency-level: ONE\n        write-consistency-level: ONE\n      }\n    }\n\n    ## Index configuration\n    index {\n      search {\n        backend: lucene\n        directory: /opt/thp/thehive/index\n      }\n    }\n  }\n}\n\nstorage {\n   provider: localfs\n   localfs.location: /opt/thp/thehive/data\n}\n\nplay.http.parser.maxDiskBuffer: 50MB\nplay.modules.enabled += org.thp.thehive.connector.cortex.CortexModule\ncortex {\n  servers = [\n    {\n      name = local\n      url = \"http://cortex:9001\"\n      auth {\n        type = \"bearer\"\n        key = \"4iDg0yQtTnfRQm9hms2ZrMkZnRlQPrtU\"\n      }\n    }\n  ]\n  # Check job update time intervalcortex\n  refreshDelay = 5 seconds\n  # Maximum number of successive errors before give up\n  maxRetryOnError = 3\n  # Check remote Cortex status time interval\n  statusCheckInterval = 30 seconds\n}\n</code></pre>"},{"location":"install_thehive4/#docker-compose-up-d","title":"\u542f\u52a8\uff1adocker-compose up -d","text":"<p>\u8fd0\u884c\u540e\u7684\u76ee\u5f55\u7ed3\u6784\uff1a</p> <pre><code>.\n\u251c\u2500\u2500 docker-compose.yml\n\u2514\u2500\u2500 vol\n    \u251c\u2500\u2500 cassandra\n    \u2502   \u2514\u2500\u2500 data\n    \u251c\u2500\u2500 cortex\n    \u2502   \u2514\u2500\u2500 application.conf\n    \u251c\u2500\u2500 elasticsearch\n    \u2502   \u251c\u2500\u2500 data\n    \u2502   \u2514\u2500\u2500 logs\n    \u2514\u2500\u2500 thehive\n        \u251c\u2500\u2500 application.conf\n        \u251c\u2500\u2500 data\n        \u2514\u2500\u2500 index\n</code></pre> <p>docker ps\u67e5\u770b\u670d\u52a1\u8fd0\u884c\u72b6\u6001\uff1a</p> <pre><code>root@TheHive:/home/thehive4# docker ps\nCONTAINER ID   IMAGE                            COMMAND                  CREATED      STATUS      PORTS                                         NAMES\nda52fee5183d   thehiveproject/cortex:latest     \"/opt/cortex/entrypo\u2026\"   4 days ago   Up 4 days   0.0.0.0:9001-&gt;9001/tcp                        cortex\n4b5691796e2b   thehiveproject/thehive4:latest   \"/opt/thehive/entryp\u2026\"   4 days ago   Up 4 days   0.0.0.0:9000-&gt;9000/tcp                        thehive4\nf015f074e82d   cassandra:3.11                   \"docker-entrypoint.s\u2026\"   4 days ago   Up 4 days   7000-7001/tcp, 7199/tcp, 9042/tcp, 9160/tcp   cassandra\n32c2682ddd0a   elasticsearch:7.11.1             \"/bin/tini -- /usr/l\u2026\"   4 days ago   Up 4 days   0.0.0.0:9200-&gt;9200/tcp, 9300/tcp              elasticsearch\n</code></pre>"},{"location":"install_thehive4/#_5","title":"\u9047\u5230\u7684\u95ee\u9898","text":"<p>thehive4\u7684\u62a5\u9519</p> <pre><code>[error] a.a.OneForOneStrategy [|] Unable to provision, see the following errors:\n\n1) Error in custom provider, Configuration error: Configuration error[\nThe application secret has not been set, and we are in prod mode. Your application is not secure.\nTo set the application secret, please read http://playframework.com/documentation/latest/ApplicationSecret\n</code></pre> <p>\u53d1\u73b0\u662fapplication.conf\u6743\u9650\u95ee\u9898\uff0c\u589e\u52a0\u6240\u6709\u7528\u6237\u7684\u53ef\u8bfb\u6743\u9650\u3002</p> <pre><code>chmod 644 application.conf\n</code></pre> <p>elasticsearch\u542f\u52a8\u5931\u8d25\uff0c\u89e3\u51b3\u65b9\u6cd5\uff1ahttps://github.com/TheHive-Project/Docker-Templates/issues/24</p> <p>chown 1000:1000  /vol/elasticsearch/data</p> <p>chown 1000:1000  /vol/elasticsearch/logs</p> <p>\u7ee7\u7eed\u62a5\u9519\uff1a</p> <pre><code>[error] o.t.s.u.Retry [|] An error occurs\njava.lang.IllegalArgumentException: Could not instantiate implementation: org.janusgraph.diskstorage.lucene.LuceneIndex\n</code></pre> <p>\u53c2\u8003\uff1ahttps://github.com/TheHive-Project/TheHive/issues/1863</p> <p>\u9700\u8981\u4fee\u6539vol/thehive\u4e0b\u7684\u6587\u4ef6\u5939\u53ca\u6587\u4ef6\u6743\u9650\u3002</p> <pre><code>chown -R 1000:1000 data\nchown -R 1000:1000 index\n</code></pre> <p>\u67e5\u770b\u5b9e\u65f6\u65e5\u5fd7\uff1a</p> <pre><code>docker logs 4b5691796e2b --follow\n</code></pre> <p>\u4fee\u6539\u4e4b\u540e\u4e0d\u518d\u62a5\u9519\u3002</p>"},{"location":"install_thehive4/#cortex","title":"\u8054\u52a8Cortex","text":"<p>\u5728Cortex\u4e2d\u521b\u5efa\u65b0\u7ec4\u7ec7\u548c\u65b0\u7ec4\u7ec7\u4e0b\u7684\u7528\u6237\uff0c\u590d\u5236API-Key\uff0c\u590d\u5236\u5230thehive\u7684\u914d\u7f6e\u6587\u4ef6application.conf\u4e2d\uff0c\u91cd\u542f\u670d\u52a1\u5373\u53ef\u3002</p>"},{"location":"install_thehive5/","title":"\u642d\u5efa the hive","text":"<p>\u65b9\u6cd51\uff1a\u5b98\u65b95.X docker\u5b89\u88c5\u3002</p> <p>\u65b9\u6cd52\uff1a\u975e\u5b98\u65b9docker\u5b89\u88c5 https://ls111.me/thehive-cortex-misp-installation-using-docker-compose/ https://github.com/ls111-cybersec/thehive-cortex-misp-docker-compose-lab11update \u6b64\u535a\u4e3b\u4e5f\u63d0\u4f9b\u4e86\u4e00\u4e2a\u5f00\u7bb1\u5373\u7528\u7684ova\u955c\u50cf\u3002</p> <p>\u65b9\u6cd53\uff1a\u4f7f\u7528OVA\u955c\u50cfhttps://docs.strangebee.com/resources/demo/</p>"},{"location":"install_thehive5/#docker","title":"\u4f7f\u7528docker\u5b89\u88c5","text":""},{"location":"install_thehive5/#_1","title":"\u53c2\u8003","text":"<p>https://chinyati.medium.com/the-hive-cortex-through-docker-installation-e50cbadb6cb0</p> <p>https://wmvalente.medium.com/installing-misp-the-hive-and-cortex-part-5-d8a21c886fa8</p> <p>https://github.com/TheHive-Project/Docker-Templates/tree/main/docker/thehive4-cortex31-shuffle</p>"},{"location":"install_thehive5/#composeyml","title":"compose.yml","text":"<p>\u6ce8\u610f\uff0cMISP\u914d\u7f6e\u4e2dHOSTNAME\u7684IP\u9700\u8981\u6839\u636e\u81ea\u5df1\u7cfb\u7edfIP\u8fdb\u884c\u4fee\u6539\u3002 \u5728TheHive\u4e2d\u914d\u7f6eMISP\u670d\u52a1\u5668\u65f6\uff0c\u9700\u8981\u4f7f\u7528https\u7684\u5f62\u5f0f\uff0c\u5e76\u5173\u95ed\u5b89\u5168\u68c0\u67e5 Do not check Certificate Autority Disable hostname Verification</p> <p>\u5982\u679c\u955c\u50cf\u65e0\u6cd5\u987a\u5229\u4e0b\u8f7d\uff0c\u53ef\u4ee5\u7528dockerhub\u7684\u4ee3\u66ff\u3002\u5e76\u548ccompose.yml\u6587\u4ef6\u4e2d\u7684image\u4fdd\u6301\u4e00\u81f4\u3002</p> <pre><code>docker pull strangebee/thehive:5.1\ndocker pull cassandra:4\ndocker pull elasticsearch:7.17.9\ndocker pull minio/minio\ndocker pull thehiveproject/cortex:3.1.7\ndocker pull coolacid/misp-docker:core-latest\ndocker pull mysql/mysql-server:5.7\ndocker pull coolacid/misp-docker:modules-latest\ndocker pull redis:5.0.6\n</code></pre> <pre><code>version: \"3\"\nservices:\n  thehive:\n    image: strangebee/thehive:5.1\n    restart: unless-stopped\n    depends_on:\n      - cassandra\n      - elasticsearch\n      - minio\n      - cortex\n    mem_limit: 1500m\n    ports:\n      - \"0.0.0.0:9000:9000\"\n    environment:\n      - JVM_OPTS=\"-Xms1024M -Xmx1024M\"\n    command:\n      - --secret\n      - \"lab123456789\"\n      - \"--cql-hostnames\"\n      - \"cassandra\"\n      - \"--index-backend\"\n      - \"elasticsearch\"\n      - \"--es-hostnames\"\n      - \"elasticsearch\"\n      - \"--s3-endpoint\"\n      - \"http://minio:9002\"\n      - \"--s3-access-key\"\n      - \"minioadmin\"\n      - \"--s3-secret-key\"\n      - \"minioadmin\"\n      - \"--s3-use-path-access-style\"\n      - \"--no-config-cortex\"\n      #- \"--cortex-port\"\n      #- \"9001\"\n      #- \"--cortex-keys\"\n      #- \"k3DZO07qOoIMfNNS5qLloPmMS2PnhMMR\"\n    volumes:\n      - thehivedata:/etc/thehive/application.conf\n    networks:\n      - SOC_NET\n\n  cassandra:\n    image: 'cassandra:4'\n    restart: unless-stopped\n    mem_limit: 1000m\n    ports:\n      - \"0.0.0.0:9042:9042\"\n    environment:\n      - CASSANDRA_CLUSTER_NAME=TheHive\n    volumes:\n      - cassandradata:/var/lib/cassandra\n    networks:\n      - SOC_NET\n\n  elasticsearch:\n    image: docker.elastic.co/elasticsearch/elasticsearch:7.17.9\n    restart: unless-stopped\n    mem_limit: 512m\n    ports:\n      - \"0.0.0.0:9200:9200\"\n    environment:\n      - discovery.type=single-node\n      - xpack.security.enabled=false\n      - cluster.name=hive\n      - http.host=0.0.0.0\n      - \"ES_JAVA_OPTS=-Xms256m -Xmx256m\"\n    volumes:\n      - elasticsearchdata:/usr/share/elasticsearch/data\n    networks:\n      - SOC_NET\n\n  minio:\n    image: quay.io/minio/minio\n    mem_limit: 512m\n    restart: unless-stopped\n    command: [\"minio\", \"server\", \"/data\", \"--console-address\", \":9002\"]\n    environment:\n      - MINIO_ROOT_USER=minioadmin\n      - MINIO_ROOT_PASSWORD=minioadmin\n    ports:\n      - \"0.0.0.0:9002:9002\"\n    volumes:\n      - \"miniodata:/data\"\n    networks:\n      - SOC_NET\n\n  cortex:\n    image: thehiveproject/cortex:3.1.7\n    restart: unless-stopped\n    environment:\n      - job_directory=/opt/cortex/jobs\n    volumes:\n      - cortexdata:/var/run/docker.sock\n      - cortexdata:/opt/cortex/jobs\n      - cortexdata:/var/log/cortex\n      - cortexdata:/cortex/application.conf\n    depends_on:\n      - elasticsearch\n    ports:\n      - \"0.0.0.0:9001:9001\"\n    networks:\n      - SOC_NET\n\n  misp:\n    image: coolacid/misp-docker:core-latest\n    restart: unless-stopped\n    depends_on: \n      - misp_mysql\n    ports:\n      - \"0.0.0.0:80:80\"\n      - \"0.0.0.0:443:443\"\n    volumes:\n      - \"./server-configs/:/var/www/MISP/app/Config/\"\n      - \"./logs/:/var/www/MISP/app/tmp/logs/\"\n      - \"./files/:/var/www/MISP/app/files\"\n      - \"./ssl/:/etc/nginx/certs\"\n    environment:\n      - MYSQL_HOST=misp_mysql\n      - MYSQL_DATABASE=mispdb\n      - MYSQL_USER=mispuser\n      - MYSQL_PASSWORD=misppass\n      - MISP_ADMIN_EMAIL=mispadmin@lab.local\n      - MISP_ADMIN_PASSPHRASE=mispadminpass\n      - MISP_BASEURL=localhost\n      - TIMEZONE=Europe/London\n      - \"INIT=true\"         \n      - \"CRON_USER_ID=1\"   \n      - \"REDIS_FQDN=redis\"\n      - \"HOSTNAME=https://192.168.76.148\"\n    networks:\n      - SOC_NET\n\n  misp_mysql:\n    image: mysql/mysql-server:5.7\n    restart: unless-stopped\n    volumes:\n      - mispsqldata:/var/lib/mysql   \n    environment:\n      - MYSQL_DATABASE=mispdb\n      - MYSQL_USER=mispuser\n      - MYSQL_PASSWORD=misppass\n      - MYSQL_ROOT_PASSWORD=mispass\n    networks:\n      - SOC_NET\n  redis:\n    image: redis:5.0.6\n    networks:\n      - SOC_NET\n  misp-modules:\n    image: coolacid/misp-docker:modules-latest\n    environment:\n      - \"REDIS_BACKEND=redis\"\n    depends_on:\n      - redis\n      - misp_mysql\n    networks:\n      - SOC_NET   \n\nvolumes:\n  miniodata:\n  cassandradata:\n  elasticsearchdata:\n  cortexdata:\n  thehivedata:\n  mispsqldata:\n\nnetworks:\n    SOC_NET:\n          driver: bridge\n</code></pre> <p>docker-compose up -d \u542f\u52a8 \u67e5\u770b\u8fd0\u884c\u72b6\u6001\uff1a</p> <pre><code>oot@h4m5t:/home/h4m5t/Desktop/misp# docker ps\nCONTAINER ID   IMAGE                                                  COMMAND                  CREATED        STATUS                  PORTS                                                       NAMES\n19b4e9b3456f   strangebee/thehive:5.1                                 \"/opt/thehive/entryp\u2026\"   40 hours ago   Up 40 hours             0.0.0.0:9000-&gt;9000/tcp                                      misp-thehive-1\n03727c8b2035   coolacid/misp-docker:core-latest                       \"/entrypoint.sh\"         40 hours ago   Up 40 hours             0.0.0.0:80-&gt;80/tcp, 0.0.0.0:443-&gt;443/tcp                    misp-misp-1\n02eef218fc79   coolacid/misp-docker:modules-latest                    \"/usr/local/bin/misp\u2026\"   40 hours ago   Up 40 hours                                                                         misp-misp-modules-1\na3595546433a   thehiveproject/cortex:3.1.7                            \"/opt/cortex/entrypo\u2026\"   40 hours ago   Up 40 hours             0.0.0.0:9001-&gt;9001/tcp                                      misp-cortex-1\nddade05aae85   cassandra:4                                            \"docker-entrypoint.s\u2026\"   40 hours ago   Up 40 hours             7000-7001/tcp, 7199/tcp, 9160/tcp, 0.0.0.0:9042-&gt;9042/tcp   misp-cassandra-1\na994b83800f8   docker.elastic.co/elasticsearch/elasticsearch:7.17.9   \"/bin/tini -- /usr/l\u2026\"   40 hours ago   Up 40 hours             0.0.0.0:9200-&gt;9200/tcp, 9300/tcp                            misp-elasticsearch-1\nfaea8de5c62f   mysql/mysql-server:5.7                                 \"/entrypoint.sh mysq\u2026\"   40 hours ago   Up 40 hours (healthy)   3306/tcp, 33060/tcp                                         misp-misp_mysql-1\n6452b2ab987b   redis:5.0.6                                            \"docker-entrypoint.s\u2026\"   40 hours ago   Up 40 hours             6379/tcp                                                    misp-redis-1\nfe0f8f43b185   quay.io/minio/minio                                    \"/usr/bin/docker-ent\u2026\"   40 hours ago   Up 40 hours             9000/tcp, 0.0.0.0:9002-&gt;9002/tcp                            misp-minio-1\n</code></pre> <p>\u67e5\u770b\u7aef\u53e3\u5f00\u653e\u60c5\u51b5</p> <pre><code>root@h4m5t:/home/h4m5t/Desktop/misp# netstat -ltpnd\nActive Internet connections (only servers)\nProto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    \ntcp        0      0 0.0.0.0:9200            0.0.0.0:*               LISTEN      198646/docker-proxy \ntcp        0      0 0.0.0.0:9042            0.0.0.0:*               LISTEN      198659/docker-proxy \ntcp        0      0 0.0.0.0:9001            0.0.0.0:*               LISTEN      198980/docker-proxy \ntcp        0      0 0.0.0.0:9000            0.0.0.0:*               LISTEN      201100/docker-proxy \ntcp        0      0 0.0.0.0:9002            0.0.0.0:*               LISTEN      198628/docker-proxy \ntcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN      199010/docker-proxy \ntcp        0      0 0.0.0.0:443             0.0.0.0:*               LISTEN      198996/docker-proxy \ntcp        0      0 127.0.0.53:53           0.0.0.0:*               LISTEN      693/systemd-resolve \ntcp        0      0 127.0.0.1:631           0.0.0.0:*               LISTEN      402601/cupsd        \ntcp6       0      0 ::1:631                 :::*                    LISTEN      402601/cupsd   \n</code></pre>"},{"location":"install_thehive5/#_2","title":"\u9047\u5230\u7684\u95ee\u9898","text":"<p>\u5bb9\u5668\u51b2\u7a81\uff1a <code>docker stop $(docker ps -aq)</code></p> <p>\u63d0\u793a\u7aef\u53e3\u51b2\u7a81\uff1a</p> <pre><code>Error starting userland proxy: listen tcp4 0.0.0.0:9042: bind: address already in use\n</code></pre> <p>\u89e3\u51b3\u65b9\u6cd5\uff1a</p> <pre><code>#\u67e5\u8be2PID\nlsof -i :9042\n\n#\u4e2d\u6b62\u670d\u52a1\nkill PID\n</code></pre> <p>\u4f7f\u7528docker-compose\u5b89\u88c5\uff0cCortex\u63d0\u793a\u65e0\u6cd5\u8fde\u63a5\u5230es,\u67e5\u770bdocker\u53d1\u73b0\uff0ces\u4e00\u76f4\u5904\u4e8e\u9000\u51fa\u72b6\u6001\u3002</p> <p>\u67e5\u770bes docker log</p> <p>\u62a5\u9519\uff1a</p> <pre><code>[root@centos1 Hive&amp;Cortex]# docker logs 7b810d62bb7b\nException in thread \"main\" java.lang.RuntimeException: starting java failed with [1]\noutput:\n[0.000s][error][logging] Error opening log file 'logs/gc.log': Permission denied\n[0.000s][error][logging] Initialization of output 'file=logs/gc.log' using options 'filecount=32,filesize=64m' failed.\nerror:\nInvalid -Xlog option '-Xlog:gc*,gc+age=trace,safepoint:file=logs/gc.log:utctime,pid,tags:filecount=32,filesize=64m', see error log for details.\nError: Could not create the Java Virtual Machine.\nError: A fatal exception has occurred. Program will exit.\n        at org.elasticsearch.tools.launchers.JvmOption.flagsFinal(JvmOption.java:119)\n        at org.elasticsearch.tools.launchers.JvmOption.findFinalOptions(JvmOption.java:81)\n        at org.elasticsearch.tools.launchers.JvmErgonomics.choose(JvmErgonomics.java:38)\n        at org.elasticsearch.tools.launchers.JvmOptionsParser.jvmOptions(JvmOptionsParser.java:135)\n        at org.elasticsearch.tools.launchers.JvmOptionsParser.main(JvmOptionsParser.java:86)\n\n</code></pre> <p>\u4fee\u6539compose\u6587\u4ef6\uff1a</p> <p>\u53c2\u8003\uff1ahttps://blog.csdn.net/qq_18848239/article/details/108158741</p> <pre><code>TAKE_FILE_OWNERSHIP=true\n</code></pre> <p>\u6253\u5f00Cortex9001\u9875\u9762\uff0c\u62a5\u9519\u5982\u4e0b\uff1a</p> <pre><code>Error:user init not found\n</code></pre> <p>\u67e5\u770b\u65e5\u5fd7\u53d1\u73b0\uff1a</p> <pre><code>[error] o.t.c.s.ErrorHandler - Internal error\njava.lang.RuntimeException: HttpResponse(429,Some(StringEntity({\"error\":{\"root_cause\":[{\"type\":\"cluster_block_exception\",\"reason\":\"index [cortex_6] blocked by: [TOO_MANY_REQUESTS/12/disk usage exceeded flood-stage watermark, index has read-only-allow-delete block];\"}],\"type\":\"cluster_block_exception\",\"reason\":\"index [cortex_6] blocked by: [TOO_MANY_REQUESTS/12/disk usage exceeded flood-stage watermark, index has read-only-allow-delete block];\"},\"status\":429},Some(UTF-8))),Map(X-elastic-product -&gt; Elasticsearch, content-type -&gt; application/json; charset=UTF-8, content-length -&gt; 399))\n</code></pre> <p>\u89e3\u51b3\u65b9\u6cd5\uff1ahttps://github.com/TheHive-Project/Cortex/issues/187</p> <p>\u67e5\u627e\u7d22\u5f15</p> <pre><code>curl -s http://localhost:9200/_all/_settings\n</code></pre> <p>\u5220\u9664\u7d22\u5f15\uff1a</p> <pre><code>curl -X DELETE http://localhost:9200/cortex_6/\"\n{\"acknowledged\":true}\n</code></pre>"},{"location":"install_thehivemisp/","title":"\u5b89\u88c5Thehive+MISP","text":""},{"location":"install_thehivemisp/#docker-compose","title":"docker-compose","text":"<pre><code>version: '3.8'\nservices:\n  ## Cortex\n  elasticsearch:\n    image: 'elasticsearch:7.11.1'\n    container_name: elasticsearch\n    restart: unless-stopped\n    ports:\n      - '0.0.0.0:9200:9200'\n    environment:\n      - http.host=0.0.0.0\n      - discovery.type=single-node\n      - cluster.name=hive\n      - script.allowed_types= inline\n      - thread_pool.search.queue_size=100000\n      - thread_pool.write.queue_size=10000\n      - gateway.recover_after_nodes=1\n      - xpack.security.enabled=false\n      - bootstrap.memory_lock=true\n      - ES_JAVA_OPTS=-Xms256m -Xmx256m\n    ulimits:\n      nofile:\n        soft: 65536\n        hard: 65536\n    volumes:\n      - './vol/elasticsearch/data:/usr/share/elasticsearch/data'\n      - './vol/elasticsearch/logs:/usr/share/elasticsearch/logs'\n\n  cortex:\n    image: 'thehiveproject/cortex:latest'\n    container_name: cortex\n    restart: unless-stopped\n    command:\n      --job-directory ${JOB_DIRECTORY}\n    environment:\n      - 'JOB_DIRECTORY=${JOB_DIRECTORY}'\n    volumes:\n      - './vol/cortex/application.conf:/etc/cortex/application.conf'\n      - '${JOB_DIRECTORY}:${JOB_DIRECTORY}'\n      - '/var/run/docker.sock:/var/run/docker.sock'\n    depends_on:\n      - elasticsearch\n    ports:\n      - '0.0.0.0:9001:9001'\n\n  ## TheHive\n  thehive:\n    image: 'thehiveproject/thehive4:latest'\n    container_name: 'thehive4'\n    depends_on:\n      - cassandra\n    ports:\n      - '0.0.0.0:9000:9000'\n    volumes:\n      - ./vol/thehive/application.conf:/etc/thehive/application.conf\n      - ./vol/thehive/data:/opt/thp/thehive/data\n      - ./vol/thehive/index:/opt/thp/thehive/index\n    networks:\n      - default\n    command: '--no-config --no-config-secret'\n\n  cassandra:\n    image: 'cassandra:3.11'\n    container_name: cassandra\n    hostname: cassandra\n    environment:\n      - MAX_HEAP_SIZE=1G\n      - HEAP_NEWSIZE=1G\n      - CASSANDRA_CLUSTER_NAME=thp\n    volumes:\n      - './vol/cassandra/data:/var/lib/cassandra/data'\n\n  ## MISP\n  misp:\n    image: coolacid/misp-docker:core-latest\n    restart: unless-stopped\n    depends_on: \n      - misp_mysql\n    ports:\n      - \"0.0.0.0:80:80\"\n      - \"0.0.0.0:443:443\"\n    volumes:\n      - \"./server-configs/:/var/www/MISP/app/Config/\"\n      - \"./logs/:/var/www/MISP/app/tmp/logs/\"\n      - \"./files/:/var/www/MISP/app/files\"\n      - \"./ssl/:/etc/nginx/certs\"\n    environment:\n      - MYSQL_HOST=misp_mysql\n      - MYSQL_DATABASE=mispdb\n      - MYSQL_USER=mispuser\n      - MYSQL_PASSWORD=misppass\n      - MISP_ADMIN_EMAIL=mispadmin@lab.local\n      - MISP_ADMIN_PASSPHRASE=mispadminpass\n      - MISP_BASEURL=localhost\n      - TIMEZONE=Europe/London\n      - \"INIT=true\"         \n      - \"CRON_USER_ID=1\"   \n      - \"REDIS_FQDN=redis\"\n      - \"HOSTNAME=https://192.168.76.148\"\n    networks:\n      - default\n\n  misp_mysql:\n    image: mysql/mysql-server:5.7\n    restart: unless-stopped\n    volumes:\n      - mispsqldata:/var/lib/mysql   \n    environment:\n      - MYSQL_DATABASE=mispdb\n      - MYSQL_USER=mispuser\n      - MYSQL_PASSWORD=misppass\n      - MYSQL_ROOT_PASSWORD=mispass\n    networks:\n      - default\n\n  redis:\n    image: redis:5.0.6\n    networks:\n      - default\n\n  misp-modules:\n    image: coolacid/misp-docker:modules-latest\n    environment:\n      - \"REDIS_BACKEND=redis\"\n    depends_on:\n      - redis\n      - misp_mysql\n    networks:\n      - default\nvolumes:\n  mispsqldata:\n\nnetworks:\n  default: null\n</code></pre>"},{"location":"install_thehivemisp/#env","title":".env","text":"<pre><code>CORTEX_KEY=[]\nCOMPOSE_PROJECT_NAME=FreeSIEM\nJOB_DIRECTORY=/opt/cortex/jobs\n</code></pre>"},{"location":"install_thehivemisp/#vol","title":"vol","text":""},{"location":"install_thehivemisp/#_1","title":"\u6587\u4ef6\u76ee\u5f55","text":"<p>\u6587\u4ef6\u8def\u5f84\u5982\u4e0b\uff1a\u547d\u4ee4\u67e5\u770b\uff1a<code>tree -L 3</code></p> <pre><code>.\n\u251c\u2500\u2500 .env\n\u251c\u2500\u2500 docker-compose.yml\n\u2514\u2500\u2500 vol\n    \u251c\u2500\u2500 cortex\n    \u2502   \u2514\u2500\u2500 application.conf\n    \u2514\u2500\u2500 elasticsearch\n        \u2514\u2500\u2500 data\n        \u2514\u2500\u2500 logs\n    \u2514\u2500\u2500 thehive\n        \u251c\u2500\u2500 application.conf\n        \u2514\u2500\u2500 data\n        \u2514\u2500\u2500 index\n</code></pre>"},{"location":"install_thehivemisp/#_2","title":"\u4fee\u6539\u6743\u9650","text":"<pre><code>chown -R 1000:1000 elasticsearch\nchown -R 1000:1000 thehive\nchown -R 1000:1000 cortex\n</code></pre>"},{"location":"install_thehivemisp/#cortexapplicationconf","title":"Cortex\u914d\u7f6e\u6587\u4ef6application.conf","text":"<pre><code>## SECRET KEY\n#\n# The secret key is used to secure cryptographic functions.\n#\n# IMPORTANT: If you deploy your application to several  instances,  make\n# sure to use the same key.\nplay.http.secret.key=\"CortexTestPassword\"\n\n## ElasticSearch\nsearch {\n  index = cortex\n  uri = \"http://elasticsearch:9200\"\n}\n\n## Cache\ncache.job = 10 minutes\n\njob {\n  runner = [docker, process]\n}\n\n## ANALYZERS\nanalyzer {\n  urls = [\n    \"https://download.thehive-project.org/analyzers.json\"\n    #\"/absolute/path/of/analyzers\"\n  ]\n}\n\n# RESPONDERS\nresponder {\n  urls = [\n    \"https://download.thehive-project.org/responders.json\"\n    #\"/absolute/path/of/responders\"\n  ]\n}\n</code></pre>"},{"location":"install_thehivemisp/#thehiveapplicationconf","title":"Thehive\u914d\u7f6e\u6587\u4ef6application.conf","text":"<pre><code># Secret Key\n# The secret key is used to secure cryptographic functions.\n# WARNING: If you deploy your application on several servers, make sure to use the same key.\nplay.http.secret.key=\"dgngu325mbnbc39cxas4l5kb24503836y2vsvsg465989fbsvop9d09ds6df6\"\n\n# JanusGraph\ndb {\n  provider: janusgraph\n  janusgraph {\n    storage {\n      backend: cql\n      hostname: [\"cassandra\"]\n\n      cql {\n        cluster-name: thp       # cluster name\n        keyspace: thehive           # name of the keyspace\n        read-consistency-level: ONE\n        write-consistency-level: ONE\n      }\n    }\n\n    ## Index configuration\n    index {\n      search {\n        backend: lucene\n        directory: /opt/thp/thehive/index\n      }\n    }\n  }\n}\n\nstorage {\n   provider: localfs\n   localfs.location: /opt/thp/thehive/data\n}\n\nplay.http.parser.maxDiskBuffer: 50MB\nplay.modules.enabled += org.thp.thehive.connector.cortex.CortexModule\ncortex {\n  servers = [\n    {\n      name = local\n      url = \"http://cortex:9001\"\n      auth {\n        type = \"bearer\"\n        key = \"4iDg0yQtTnfRQm9hms2ZrMkZnRlQPrtU\"\n      }\n    }\n  ]\n  # Check job update time intervalcortex\n  refreshDelay = 5 seconds\n  # Maximum number of successive errors before give up\n  maxRetryOnError = 3\n  # Check remote Cortex status time interval\n  statusCheckInterval = 30 seconds\n}\n</code></pre>"},{"location":"install_thehivemisp/#docker-compose-up-d","title":"\u542f\u52a8\uff1adocker-compose up -d","text":"<pre><code>CONTAINER ID   IMAGE                                 COMMAND                  CREATED          STATUS                    PORTS                                         NAMES\n06d8e0c4246a   thehiveproject/thehive4:latest        \"/opt/thehive/entryp\u2026\"   17 minutes ago   Up 17 minutes             0.0.0.0:9000-&gt;9000/tcp                        thehive4\n8e89e636f930   coolacid/misp-docker:modules-latest   \"/usr/local/bin/misp\u2026\"   17 minutes ago   Up 17 minutes                                                           freesiem-misp-modules-1\n399f0e6e4d55   coolacid/misp-docker:core-latest      \"/entrypoint.sh\"         17 minutes ago   Up 17 minutes             0.0.0.0:80-&gt;80/tcp, 0.0.0.0:443-&gt;443/tcp      freesiem-misp-1\n4f3de964e586   thehiveproject/cortex:latest          \"/opt/cortex/entrypo\u2026\"   17 minutes ago   Up 17 minutes             0.0.0.0:9001-&gt;9001/tcp                        cortex\ncf9975c728f2   redis:5.0.6                           \"docker-entrypoint.s\u2026\"   17 minutes ago   Up 17 minutes             6379/tcp                                      freesiem-redis-1\nabbafb6a13d7   cassandra:3.11                        \"docker-entrypoint.s\u2026\"   17 minutes ago   Up 17 minutes             7000-7001/tcp, 7199/tcp, 9042/tcp, 9160/tcp   cassandra\nb22fa07b1444   mysql/mysql-server:5.7                \"/entrypoint.sh mysq\u2026\"   17 minutes ago   Up 17 minutes (healthy)   3306/tcp, 33060/tcp                           freesiem-misp_mysql-1\n5e6090a3b480   elasticsearch:7.11.1                  \"/bin/tini -- /usr/l\u2026\"   17 minutes ago   Up 17 minutes             0.0.0.0:9200-&gt;9200/tcp, 9300/tcp              elasticsearch\n</code></pre>"},{"location":"install_wazuh/","title":"Wazuh\u5b89\u88c5","text":""},{"location":"install_wazuh/#_1","title":"\u4ecb\u7ecd","text":"<p>Wazuh \u662f\u4e00\u4e2a\u5b89\u5168\u5e73\u53f0\uff0c\u53ef\u4e3a\u7aef\u70b9\u548c\u4e91\u5de5\u4f5c\u8d1f\u8f7d\u63d0\u4f9b\u7edf\u4e00\u7684 XDR \u548c SIEM \u4fdd\u62a4\u3002\u8be5\u89e3\u51b3\u65b9\u6848\u7531\u4e00\u4e2a\u901a\u7528\u4ee3\u7406\u548c\u4e09\u4e2a\u4e2d\u5fc3\u7ec4\u4ef6\u7ec4\u6210\uff1aWazuh \u670d\u52a1\u5668\u3001Wazuh \u7d22\u5f15\u5668\u548c Wazuh \u4eea\u8868\u677f\u3002</p> <p>Wazuh is a security platform that provides unified XDR and SIEM protection for endpoints and cloud workloads. The solution is composed of a single universal agent and three central components: the Wazuh server, the Wazuh indexer, and the Wazuh dashboard.</p> <p>The Wazuh platform helps organizations and individuals protect their data assets through threat prevention, detection, and response. Besides, Wazuh is also employed to meet regulatory compliance requirements, such as PCI DSS or HIPAA, and configuration standards like CIS hardening guides.</p> <p>\u5b98\u7f51\uff1ahttps://wazuh.com/</p> <p>\u5b98\u65b9\u6587\u6863\uff1ahttps://documentation.wazuh.com/</p> <p>GitHub\u4ed3\u5e93\uff1ahttps://github.com/wazuh/wazuh</p> <p>\u4f7f\u7528\u573a\u666f\uff1a</p> Log data analysis File integrity monitoring Rootkits detection Active response Configuration assessment System inventory Vulnerability detection Cloud security Container security Regulatory compliance"},{"location":"install_wazuh/#_2","title":"\u90e8\u7f72\u65b9\u5f0f","text":"<p>\u672c\u6b21\u91c7\u7528\u5355\u8282\u70b9\u90e8\u7f72\u3002\u5bf9\u4e8e\u8f83\u5927\u73af\u5883\uff0c\u5efa\u8bae\u91c7\u7528\u5206\u5e03\u5f0f\u90e8\u7f72\uff0c\u591a\u8282\u70b9\u96c6\u7fa4\u914d\u7f6e\uff0c\u4ece\u800c\u63d0\u4f9b\u9ad8\u53ef\u7528\u6027\u548c\u8d1f\u8f7d\u5e73\u8861\u3002</p>"},{"location":"install_wazuh/#_3","title":"\u786c\u4ef6\u8981\u6c42","text":"Agents CPU RAM Storage (90 days) 1\u201325 4 vCPU 8 GiB 50 GB 25\u201350 8 vCPU 8 GiB 100 GB 50\u2013100 8 vCPU 8 GiB 200 GB"},{"location":"install_wazuh/#_4","title":"\u5f00\u653e\u7aef\u53e3","text":"Component Port Protocol Purpose Wazuh server 1514 TCP (default) Agent connection service 1514 UDP (optional) Agent connection service (disabled by default) 1515 TCP Agent enrollment service 1516 TCP Wazuh cluster daemon 514 UDP (default) Wazuh Syslog collector (disabled by default) 514 TCP (optional) Wazuh Syslog collector (disabled by default) 55000 TCP Wazuh server RESTful API Wazuh indexer 9200 TCP Wazuh indexer RESTful API 9300-9400 TCP Wazuh indexer cluster communication Wazuh dashboard 443 TCP Wazuh web user interface"},{"location":"install_wazuh/#ova","title":"OVA\u955c\u50cf\u90e8\u7f72","text":""},{"location":"install_wazuh/#_5","title":"\u4e0b\u8f7d\u5e76\u542f\u52a8","text":"<p>\u4e0b\u8f7d\u955c\u50cf\u6587\u4ef6\uff1ahttps://documentation.wazuh.com/current/deployment-options/virtual-machine/virtual-machine.html</p> <p>\u6b64\u955c\u50cf\u662f\u57fa\u4e8eCentOS7\u3002</p> <p>\u5728\u865a\u62df\u5316\u5e73\u53f0\uff08VMware,ESXi,VirtualBox,Hyper-V\u7b49\uff09\u4e0a\u5bfc\u5165\u548c\u542f\u52a8\u6b64OVA\u3002</p> <p>\u4ee5VMware\u4e3a\u4f8b\uff1a\u70b9\u51fb\u6253\u5f00\u865a\u62df\u673a\uff0c\u9009\u62e9\u4e0b\u8f7d\u597d\u7684OVA\u955c\u50cf\uff0c\u5bfc\u5165\u3002</p> <p>\u7cfb\u7edf\u767b\u5f55\uff1a</p> <p><code>root</code>\u7528\u6237\u7684\u5bc6\u7801\u4e5f\u662f<code>wazuh</code>\u3002\u4f46\u662f\uff0c\u53ea\u80fd\u4f7f\u7528\u7cfb\u7edf\u7528\u6237\u901a\u8fc7 SSH \u8bbf\u95ee\u865a\u62df\u673a\u3002\u7981\u7528 root \u7528\u6237\u7684 SSH \u767b\u5f55\u3002</p> <pre><code>user: wazuh-user\npassword: wazuh\n</code></pre> <p>\u5b89\u88c5\u51e0\u4e2a\u5de5\u5177\u5305(\u4fbf\u4e8e\u540e\u9762\u64cd\u4f5c\uff0c\u53ef\u4ee5\u4e0d\u88c5\uff0c\u5982\u9700\u7528\u5230\u518d\u88c5)\uff1a</p> <pre><code>yum -y install vim\nyum -y install psmisc\nyum -y install net-tools\nyum -y install lvm2\n</code></pre>"},{"location":"install_wazuh/#_6","title":"\u914d\u7f6e\u7cfb\u7edf\u65f6\u95f4","text":"<p>\u4fee\u6539\u65f6\u533a</p> <pre><code>\u5907\u4efd\u539f\u59cb\u65f6\u95f4\u6587\u4ef6\nmv /etc/localtime /etc/localtime.bak\n\u521b\u5efa\u8f6f\u8fde\u63a5\uff0c\u4fee\u6539\u4e3aCST\u65f6\u533a\nln -s /usr/share/zoneinfo/Asia/Shanghai /etc/localtime\n</code></pre>"},{"location":"install_wazuh/#_7","title":"\u78c1\u76d8\u6269\u5bb9","text":"<p>\u4e0b\u8f7d\u597d\u7684OVA\u6253\u5f00\u9ed8\u8ba4\u662f50G\uff0c\u9700\u8981\u6269\u5c55\u78c1\u76d8\u3002\u9996\u5148\u5728VMware\u4e2d\u8c03\u6b63\u78c1\u76d8\u5927\u5c0f\u3002</p> <p>\u7136\u540e\u5728\u5ba2\u6237\u673a\u64cd\u4f5c\u7cfb\u7edf\u5185\u90e8\u5bf9\u78c1\u76d8\u91cd\u65b0\u8fdb\u884c\u5206\u533a\u548c\u6269\u5c55\u6587\u4ef6\u7cfb\u7edf\u3002</p> <p>\u5982\u679c\u65b0\u589e\u7684\u78c1\u76d8\u5728sdb,\u9700\u8981\u4f7f\u7528vgdisplay(\u67e5\u770b\u5377\u7ec4\u4fe1\u606f)\u3001vgextend(\u6269\u5c55\u5377\u7ec4)\u7b49\u547d\u4ee4\uff0c\u56e0\u6b64\u9700\u8981\u5b89\u88c5lvm2\u5de5\u5177\uff0c\u518d\u8fdb\u884c\u6269\u5bb9\u64cd\u4f5c\uff0c\u53ef\u4ee5\u53c2\u8003thehive\u5b89\u88c5\u6559\u7a0b\u4e2d\u78c1\u76d8\u6269\u5bb9\u7ae0\u8282\u3002</p> <p>\u53c2\u8003\u8fde\u63a5\uff1ahttps://github.com/wazuh/wazuh/issues/11017</p> <p>\u6269\u5bb9\u524d\uff1a</p> <pre><code>[root@wazuh-server /]# lsblk\nNAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT\nsda      8:0    0  100G  0 disk\n\u2514\u2500sda1   8:1    0   50G  0 part /\nsr0     11:0    1 1024M  0 rom\n[root@wazuh-server /]# df -hl\nFilesystem      Size  Used Avail Use% Mounted on\ndevtmpfs        3.9G     0  3.9G   0% /dev\ntmpfs           3.9G   60K  3.9G   1% /dev/shm\ntmpfs           3.9G  8.9M  3.9G   1% /run\ntmpfs           3.9G     0  3.9G   0% /sys/fs/cgroup\n/dev/sda1        50G  6.8G   44G  14% /\ntmpfs           799M     0  799M   0% /run/user/1000\n</code></pre> <pre><code>[root@wazuh-server /]# parted /dev/sda  print free\nModel: ATA VMware Virtual I (scsi)\nDisk /dev/sda: 107GB\nSector size (logical/physical): 512B/512B\nPartition Table: msdos\nDisk Flags:\n\nNumber  Start   End     Size    Type     File system  Flags\n        32.3kB  1049kB  1016kB           Free Space\n 1      1049kB  53.7GB  53.7GB  primary  xfs\n        53.7GB  107GB   53.7GB           Free Space\n\n[root@wazuh-server /]# fdisk -l\n\nDisk /dev/sda: 107.4 GB, 107374182400 bytes, 209715200 sectors\nUnits = sectors of 1 * 512 = 512 bytes\nSector size (logical/physical): 512 bytes / 512 bytes\nI/O size (minimum/optimal): 512 bytes / 512 bytes\nDisk label type: dos\nDisk identifier: 0x000a05f8\n\n   Device Boot      Start         End      Blocks   Id  System\n/dev/sda1            2048   104857599    52427776   83  Linux\n</code></pre> <p>\u8fdb\u884c\u6269\u5bb9\uff1a\u5728\u6b64\u5904\uff0c\u6211\u5c06sda1\u4ece50G\u6269\u5bb9\u4e3a100G\u3002</p> <pre><code>#\u542f\u52a8\u4e00\u4e2a\u5206\u533a\u5411\u5bfc\n[root@wazuh-server /]# fdisk /dev/sda\nWelcome to fdisk (util-linux 2.23.2).\n\nChanges will remain in memory only, until you decide to write them.\nBe careful before using the write command.\n\n\nCommand (m for help): d\nSelected partition 1\nPartition 1 is deleted\n\nCommand (m for help): n\nPartition type:\n   p   primary (0 primary, 0 extended, 4 free)\n   e   extended\nSelect (default p):\nUsing default response p\nPartition number (1-4, default 1):\nFirst sector (2048-209715199, default 2048):\nUsing default value 2048\nLast sector, +sectors or +size{K,M,G} (2048-209715199, default 209715199):\nUsing default value 209715199\nPartition 1 of type Linux and of size 100 GiB is set\n\nCommand (m for help): w\nThe partition table has been altered!\n\nCalling ioctl() to re-read partition table.\n\nWARNING: Re-reading the partition table failed with error 16: Device or resource busy.\nThe kernel still uses the old table. The new table will be used at\nthe next reboot or after you run partprobe(8) or kpartx(8)\nSyncing disks.\n\n[root@wazuh-server /]# lsblk\nNAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT\nsda      8:0    0  100G  0 disk\n\u2514\u2500sda1   8:1    0   50G  0 part /\nsr0     11:0    1 1024M  0 rom\n\n#\u6839\u636e\u4e0a\u9762\u7684\u8b66\u544a\u4fe1\u606f\uff0c\u9700\u8981\u8fd0\u884c\u5982\u4e0b\u547d\u4ee4\u3002\n[root@wazuh-server /]# partprobe\n\n[root@wazuh-server /]# lsblk\nNAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT\nsda      8:0    0  100G  0 disk\n\u2514\u2500sda1   8:1    0  100G  0 part /\nsr0     11:0    1 1024M  0 rom\n\n#\u76ee\u524d\u53ea\u8c03\u6574\u4e86\u5206\u533a\u7684\u5927\u5c0f\uff0c\u63a5\u4e0b\u6765\u9700\u8981\u8c03\u6574\u6587\u4ef6\u7cfb\u7edf\u7684\u5927\u5c0f\n[root@wazuh-server /]# xfs_growfs /dev/sda1\nmeta-data=/dev/sda1              isize=512    agcount=6, agsize=2621376 blks\n         =                       sectsz=512   attr=2, projid32bit=1\n         =                       crc=1        finobt=0 spinodes=0\ndata     =                       bsize=4096   blocks=13106944, imaxpct=25\n         =                       sunit=0      swidth=0 blks\nnaming   =version 2              bsize=4096   ascii-ci=0 ftype=1\nlog      =internal               bsize=4096   blocks=5119, version=2\n         =                       sectsz=512   sunit=0 blks, lazy-count=1\nrealtime =none                   extsz=4096   blocks=0, rtextents=0\ndata blocks changed from 13106944 to 26214144\n</code></pre> <p>\u6211\u5efa\u8bae\u6269\u5bb9\u4e4b\u540e\u518d\u91cd\u542f\u4e00\u6b21\u64cd\u4f5c\u7cfb\u7edf\u3002</p> <p>\u67e5\u770b\u6269\u5bb9\u540e\u7684\u78c1\u76d8\u60c5\u51b5\uff1a</p> <pre><code>[root@wazuh-server /]# lsblk\nNAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT\nsda      8:0    0  100G  0 disk\n\u2514\u2500sda1   8:1    0  100G  0 part /\nsr0     11:0    1 1024M  0 rom\n[root@wazuh-server /]# df -hl\nFilesystem      Size  Used Avail Use% Mounted on\ndevtmpfs        3.9G     0  3.9G   0% /dev\ntmpfs           3.9G   60K  3.9G   1% /dev/shm\ntmpfs           3.9G  8.9M  3.9G   1% /run\ntmpfs           3.9G     0  3.9G   0% /sys/fs/cgroup\n/dev/sda1       100G  7.1G   93G   8% /\ntmpfs           799M     0  799M   0% /run/user/1000\n[root@wazuh-server /]# parted /dev/sda  print free\nModel: ATA VMware Virtual I (scsi)\nDisk /dev/sda: 107GB\nSector size (logical/physical): 512B/512B\nPartition Table: msdos\nDisk Flags:\n\nNumber  Start   End     Size    Type     File system  Flags\n        32.3kB  1049kB  1016kB           Free Space\n 1      1049kB  107GB   107GB   primary  xfs\n</code></pre>"},{"location":"install_wazuh/#_8","title":"\u7f51\u7edc\u914d\u7f6e","text":"<p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u7f51\u7edc\u4e3a\u6865\u63a5\u6a21\u5f0f\u3002\u5728VMware\u4e2d\u6539\u4e3aNAT\u6a21\u5f0f\u3002</p> <p>VM \u5c06\u5c1d\u8bd5\u4ece\u7f51\u7edc DHCP \u670d\u52a1\u5668\u83b7\u53d6 IP \u5730\u5740\u3002\u6216\u8005\uff0c\u53ef\u4ee5\u901a\u8fc7\u5728 VM \u6240\u57fa\u4e8e\u7684 CentOS \u64cd\u4f5c\u7cfb\u7edf\u4e2d\u914d\u7f6e\u9002\u5f53\u7684\u7f51\u7edc\u6587\u4ef6\u6765\u8bbe\u7f6e\u9759\u6001 IP \u5730\u5740\u3002</p> <p>\u8bbe\u7f6e\u7f51\u7edc\uff1a</p> <pre><code>vi /etc/sysconfig/network-scripts/ifcfg-eth0\n</code></pre> <p>\u5176\u4e2d\uff0c\u7f51\u5173\uff0cDNS\u7b49\u6839\u636e\u60c5\u51b5\u81ea\u884c\u914d\u7f6e\u3002</p> <pre><code>DEVICE=eth0\nONBOOT=yes\nBOOTPROTO=static\nTYPE=Ethernet\nNM_CONTROLLED=no\nIPADDR=192.168.76.149\nNETMASK=255.255.255.0\nGATEWAY=192.168.76.2\nDNS=172.31.1.1\n</code></pre> <p>\u91cd\u542f\u7f51\u5361\u3002</p> <p>systemctl restart network</p>"},{"location":"install_wazuh/#_9","title":"\u914d\u7f6e\u6587\u4ef6","text":"<p>\u8be5\u865a\u62df\u6620\u50cf\u4e2d\u5305\u542b\u7684\u6240\u6709\u7ec4\u4ef6\u5747\u914d\u7f6e\u4e3a\u5f00\u7bb1\u5373\u7528\uff0c\u65e0\u9700\u4fee\u6539\u4efb\u4f55\u8bbe\u7f6e\u3002\u7136\u800c\uff0c\u6240\u6709\u7ec4\u4ef6\u90fd\u53ef\u4ee5\u5b8c\u5168\u5b9a\u5236\u3002\u8fd9\u4e9b\u662f\u914d\u7f6e\u6587\u4ef6\u4f4d\u7f6e\uff1a</p> <ul> <li> <p>Wazuh manager: <code>/var/ossec/etc/ossec.conf</code></p> </li> <li> <p>Wazuh indexer: <code>/etc/wazuh-indexer/opensearch.yml</code></p> </li> <li> <p>Filebeat-OSS: <code>/etc/filebeat/filebeat.yml</code></p> </li> <li> <p>Wazuh dashboard:</p> </li> </ul> <ul> <li><code>/etc/wazuh-dashboard/opensearch_dashboards.yml</code></li> <li><code>/usr/share/wazuh-dashboard/data/wazuh/config/wazuh.yml</code></li> </ul>"},{"location":"install_wazuh/#web","title":"web\u754c\u9762\u767b\u5f55","text":"<p>\u6253\u5f00web\u754c\u9762\u3002\u7528\u521a\u624d\u7684IP\u767b\u5f55\u3002https://192.168.76.149</p> <pre><code>user: admin\npassword: admin\n</code></pre>"},{"location":"install_wazuh/#_10","title":"\u5b89\u88c5\u5ba2\u6237\u7aef\u4ee3\u7406","text":"<p>https://documentation.wazuh.com/current/installation-guide/wazuh-agent/index.html</p> <p>The Wazuh agent provides key features to enhance your system\u2019s security.</p> Log collector Command execution File integrity monitoring (FIM) Security configuration assessment (SCA) System inventory Malware detection Active response Container security Cloud security <p>\u6ce8\u610f\uff1a</p> <ul> <li>\u5982\u679c\u5728\u5177\u6709\u5927\u91cf\u670d\u52a1\u5668\u6216\u7aef\u70b9\u7684\u5927\u578b\u73af\u5883\u4e2d\u90e8\u7f72 Wazuh\uff0c\u5efa\u8bae\u4f7f\u7528Puppet\u3001Chef\u3001 SCCM \u6216Ansible\u7b49\u81ea\u52a8\u5316\u5de5\u5177</li> <li>\u5728\u5b89\u88c5Wazuh agent and the Wazuh manager\uff0c\u8981\u6ce8\u610f\u7248\u672c\u7684\u517c\u5bb9\u6027\u3002</li> </ul> <p>\u5b89\u88c5\u65b9\u5f0f\uff1a</p> <ul> <li>\u6839\u636e\u5b98\u65b9\u6559\u7a0b\u5b89\u88c5</li> <li>\u5728Wazuh\u4eea\u8868\u76d8-&gt;\u4ee3\u7406\uff0c\u70b9\u51fb\u90e8\u7f72\u65b0\u4ee3\u7406\uff0c\u6839\u636e\u63d0\u793a\u5b89\u88c5\u3002</li> </ul> <p>\u4e0d\u540c\u7cfb\u7edf\u5bf9\u5e94\u4e0d\u540c\u7684\u5ba2\u6237\u7aef\u5b89\u88c5\u5305\u3002</p> <p>\u4ee5Ubuntu\u4e3a\u4f8b</p> <pre><code>curl -so wazuh-agent.deb https://packages.wazuh.com/4.x/apt/pool/main/w/wazuh-agent/wazuh-agent_4.4.4-1_amd64.deb &amp;&amp; sudo WAZUH_MANAGER='192.168.76.149' WAZUH_AGENT_NAME='TheHive' dpkg -i ./wazuh-agent.deb\n</code></pre> <p>\u5728\u7eaf\u5185\u7f51\u73af\u5883\u4e0b\uff0c\u53ef\u4ee5\u624b\u52a8\u4e0a\u4f20\u5ba2\u6237\u7aef\u5b89\u88c5\u5305\u3002\u4e0b\u8f7d\u4e4b\u540e\u4f7f\u7528sftp\u4e0a\u4f20\u5230\u670d\u52a1\u5668\uff0c\u5c06\u5b89\u88c5\u5305\u547d\u540d\u4e3a\uff1awazuh-agent.deb</p> <pre><code>sudo WAZUH_MANAGER='192.168.76.149' WAZUH_AGENT_NAME='TheHive' dpkg -i ./wazuh-agent.deb\n</code></pre> <p>\u542f\u52a8\u5ba2\u6237\u7aef</p> <pre><code>sudo systemctl daemon-reload\nsudo systemctl enable wazuh-agent\nsudo systemctl start wazuh-agent\n</code></pre>"},{"location":"install_wazuh/#wazuhshuffle","title":"Wazuh\u96c6\u6210Shuffle","text":"<p>\u53c2\u8003\uff1a</p> <p>https://documentation.wazuh.com/current/user-manual/manager/manual-integration.html#shuffle</p> <p>https://github.com/Shuffle/Shuffle/tree/main/functions/extensions/wazuh</p> <p>\u6700\u65b0\u7248Wazuh4.4\u5df2\u96c6\u6210\uff0c\u53ea\u9700\u6539\u4fee\u914d\u7f6e\u6587\u4ef6\u5373\u53ef\u3002</p> <pre><code>[root@wazuh-server etc]# ls /var/ossec/integrations/\npagerduty  shuffle  shuffle.py  slack  slack.py  virustotal  virustotal.py\n</code></pre> <p>\u4fee\u6539Wazuh\u914d\u7f6e\u6587\u4ef6\uff1a\uff08\u53ef\u5728\u524d\u7aef\u9875\u9762\u4fee\u6539\u6216\u8005\u5728\u540e\u53f0\u4fee\u6539\uff09</p> <pre><code>vi /var/ossec/etc/ossec.conf\n</code></pre> <p>\u6dfb\u52a0\u5982\u4e0b\u96c6\u6210\u3002\u53ef\u4ee5\u6dfb\u52a0\u591a\u4e2a\uff0c\u6839\u636elevel\u6216\u8005rule_id\u53bb\u53d1\u9001\u7279\u5b9a\u7684\u544a\u8b66\u5230Shuffle.</p> <p>Level\u53c2\u6570\u662f\u5c06\u5927\u4e8e\u6b64Level\u7684\u544a\u8b66\u53d1\u9001\u5230webhook.</p> <p>The rule level filter is optional. You can remove it or set another level value for the integration.</p> <p>\u5982\u679c\u914d\u7f6erule_id\uff0c\u5374\u672a\u63a5\u6536\u5230\u544a\u8b66\uff0c\u5f85\u6392\u67e5\u3002</p> <p>\u5176\u4e2d\uff0chook_url\u662fShuffle\u7684webhook\u63d0\u4f9b\u7684URL\uff0c\u6ce8\u610f\u5728Shuffle\u4e2d\u8981Start\u3002</p> <pre><code>&lt;integration&gt;\n  &lt;name&gt;shuffle&lt;/name&gt;\n  &lt;level&gt;5&lt;/level&gt;\n  &lt;hook_url&gt;https://172.29.132.142:3443/api/v1/hooks/webhook_22081c9c-0af3-4008-9e68-6820c14b7767&lt;/hook_url&gt;\n  &lt;alert_format&gt;json&lt;/alert_format&gt;\n&lt;/integration&gt;\n</code></pre> <p>\u91cd\u542f</p> <pre><code>systemctl restart wazuh-manager\n</code></pre> <p>\u67e5\u770b\u96c6\u6210\u65e5\u5fd7</p> <pre><code>tail -f /var/ossec/logs/integrations.log\n</code></pre> <p>\u65e5\u5fd7\u663e\u793a\u5df2\u53d1\u9001\u5230\u7279\u5b9a\u7684URL\u3002</p> <pre><code>Fri Jul 07 16:18:59 CST 2023 /tmp/shuffle-1688717939--1205532141.alert  https://172.29.132.142:3443/api/v1/hooks/webhook_22081c9c-0af3-4008-9e68-6820c14b7767  &gt; /dev/null 2&gt;&amp;1\nFri Jul 07 16:30:41 CST 2023 /tmp/shuffle-1688718641--724724010.alert  https://172.29.132.142:3443/api/v1/hooks/webhook_22081c9c-0af3-4008-9e68-6820c14b7767  &gt; /dev/null 2&gt;&amp;1\nFri Jul 07 16:30:41 CST 2023 /tmp/shuffle-1688718641--928694779.alert  https://172.29.132.142:3443/api/v1/hooks/webhook_22081c9c-0af3-4008-9e68-6820c14b7767  &gt; /dev/null 2&gt;&amp;1\n</code></pre> <p>\u5728Shuffle\u4e2d\u4f7f\u7528Shuffle Tools\uff0c\u8f93\u51fa\u6b64\u544a\u8b66\u8fdb\u884c\u67e5\u770b\u3002</p>"},{"location":"install_wazuh/#syslog","title":"\u63a5\u6536syslog","text":"<p>\u4e0b\u9762\u914d\u7f6e\u662f\u5728Wazuh-Agent\u6240\u5728\u7684Linux\u7cfb\u7edf\u4e0a\u8fdb\u884c\u914d\u7f6e\u3002</p> <p>\u53c2\u8003\uff1a</p> <p>https://documentation.wazuh.com/current/cloud-service/your-environment/send-syslog-data.html#rsyslog-on-linux</p> <p>https://wazuh.com/blog/integrating-wazuh-with-shuffle/</p> <p>\u6709\u4e9b\u670d\u52a1\u5668\u4e0d\u65b9\u4fbf\u6216\u65e0\u6cd5\u5b89\u88c5Wazuh-Agent\u5ba2\u6237\u7aef\uff0c\u6b64\u65f6\u53ef\u4ee5\u901a\u8fc7syslog\u4f20\u8f93\u65e5\u5fd7\u3002</p> <p>\u53ef\u4ee5\u5c06\u670d\u52a1\u5668\u7684\u65e5\u5fd7\u901a\u8fc7syslog\u53d1\u9001\u5230\u7279\u5b9a\u7684\u4e2d\u8f6c\u670d\u52a1\u5668\u3002\u5728\u6b64\u4e2d\u8f6c\u670d\u52a1\u5668\u4e0a\u5b89\u88c5Wazuh-Agent.</p> <p>\u4fee\u6539\u4e2d\u8f6c\u670d\u52a1\u5668\u7684syslog\u914d\u7f6e</p> <pre><code>vim /etc/rsyslog.conf\n</code></pre> <p>\u76d1\u542cUDP\u7aef\u53e3514\uff0c\u5e76\u63a5\u6536\u6765\u81ea\u7279\u5b9aIP\u7684\u65e5\u5fd7\u6d88\u606f\uff0c\u5e76\u5199\u5165\u5230\u7279\u5b9a\u7684\u6587\u4ef6\u3002</p> <pre><code>$ModLoad imudp\n$UDPServerRun 514\n\n#Storing Messages from a Remote System into a specific File\nif $fromhost-ip == '172.xx.xx.x' then /var/log/specific.log\n&amp; ~\n</code></pre> <p>\u4fee\u6539\u4e2d\u8f6c\u670d\u52a1\u5668\u4e0aWazuh-Agent\u7684\u914d\u7f6e</p> <pre><code>vi /var/ossec/etc/ossec.conf\n</code></pre> <p>\u589e\u52a0\u4e0b\u9762\u51e0\u884c\uff1a</p> <pre><code>&lt;localfile&gt;\n&lt;log_format&gt;syslog&lt;/log_format&gt;\n&lt;location&gt;/var/log/specific.log&lt;/location&gt;\n&lt;/localfile&gt;\n</code></pre> <p>\u91cd\u542fsyslog\u670d\u52a1\u548cWazuh-Agent</p> <pre><code>systemctl restart rsyslog\nsystemctl restart wazuh-agent\n</code></pre> <p>\u53ef\u4ee5\u4f7f\u7528tcpdump\u6293\u5305\u67e5\u770b\u6570\u636e\u6d41\u3002</p>"},{"location":"learnshipin/","title":"\u5b66\u4e60\u89c6\u9891","text":"<p>https://www.youtube.com/watch?v=VqIuP0AOCBg&amp;list=PLB6hQ_WpB6U16_-P_VyRIKerjI71ZVsdb</p> <p>https://www.youtube.com/watch?v=t4EJ98BNcvw&amp;list=PLB6hQ_WpB6U0WeroZAfssgRpxW8olnkqy</p> <p>https://www.youtube.com/watch?v=6DPmzXXVo_M&amp;list=PLjWEV7pmvSa7cXTkCppnYHERUdy8Dd71x</p> <p>https://www.youtube.com/watch?v=UdUGortZN4o&amp;list=PLjWEV7pmvSa4yvhzNsCjOJovOn1LLyBXB</p> <p>https://www.youtube.com/watch?v=Vr4flc55S5c</p>"},{"location":"learnshipin/#_2","title":"\u5176\u4ed6\u8d44\u6599","text":"<p>https://github.com/pleibling/FreeSOC/tree/main</p> <p>https://github.com/archanchoudhury/SOC-OpenSource</p>"},{"location":"reference/","title":"\u53c2\u8003\u81f4\u8c22","text":""},{"location":"reference/#_2","title":"\u53c2\u8003\u6587\u732e","text":"<p>https://squidfunk.github.io/mkdocs-material https://github.com/satan1a/TheRoadOfSO https://docs.readthedocs.io/en/stable/intro/getting-started-with-mkdocs.html https://www.mkdocs.org/</p>"},{"location":"reference/#_3","title":"\u6587\u6863\u7cfb\u7edf","text":"<p>Github\u6258\u7ba1\u6587\u6863\uff0cGitHub Actions\u5de5\u4f5c\u6d41\uff0c\u4f7f\u7528mkdocs,\u4ee5\u53ca\u4f18\u79c0\u7684mkdocs-material\u4e3b\u9898</p>"}]}